// ==UserScript==
// @name         ranobe-ebook-loader
// @namespace    mailto:taraflex.red@gmail.com
// @version      0.2.8
// @author       Taraflex <taraflex.red@gmail.com>
// @description  Юзерскрипт для скачивания книг (fb2, epub) c https://ранобэ.рф/ , https://ranobes.com/ , https://tl.rulate.ru/ , https://jaomix.ru/
// @license      MIT
// @homepageURL  https://github.com/Taraflex/ranobe-ebook-loader
// @icon         https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/icons/32.png
// @icon64       https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/icons/64.png
// @downloadURL  https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/build/ranobe-ebook-loader.user.js
// @updateURL    https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/build/ranobe-ebook-loader.meta.js
// @supportURL   https://github.com/Taraflex/ranobe-ebook-loader/issues
// @match        https://ранобэ.рф/*
// @match        https://xn--80ac9aeh6f.xn--p1ai/*
// @match        https://ranobes.com/ranobe/*
// @match        https://tl.rulate.ru/book/*
// @match        https://jaomix.ru/*
// @connect      *
// @run-at       document-idle
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        GM.xmlHttpRequest
// @noframes     
// ==/UserScript==
const e=()=>{document.removeEventListener("DOMContentLoaded",e);const t=document.createElement("div");t.id="ranobe-ebook-loader",document.body.appendChild(t),Promise.resolve().then((()=>Cn)).then((e=>new e.default({target:t})))};function t(){}"complete"===document.readyState||"interactive"===document.readyState?e():document.addEventListener("DOMContentLoaded",e);const n=e=>e;function r(e){return e()}function o(){return Object.create(null)}function i(e){e.forEach(r)}function a(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(e,n,r){e.$$.on_destroy.push(((e,...n)=>{if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r})(n,r))}function c(e,t,n,r){return e[1]&&r?((e,t)=>{for(const n in t)e[n]=t[n];return e})(n.ctx.slice(),e[1](r(t))):n.ctx}function u(e){return e&&a(e.destroy)?e.destroy:t}const d="undefined"!=typeof window;let f=d?()=>window.performance.now():()=>Date.now(),p=d?e=>requestAnimationFrame(e):t;const h=new Set;function m(e){h.forEach((t=>{t.c(e)||(h.delete(t),t.f())})),0!==h.size&&p(m)}function g(e,t){e.appendChild(t)}function y(e,t,n){const r=b(e);if(!r.getElementById(t)){const e=k("style");e.id=t,e.textContent=n,w(r,e)}}function b(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function v(e){const t=k("style");return w(b(e),t),t.sheet}function w(e,t){g(e.head||e,t)}function x(e,t,n){e.insertBefore(t,n||null)}function $(e){e.parentNode.removeChild(e)}function k(e){return document.createElement(e)}function _(e){return document.createTextNode(e)}function S(){return _(" ")}function A(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function E(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function M(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function O(e,t,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,!1,t),r}class C{constructor(){this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.e=k(t.nodeName),this.t=t,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)x(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach($)}}const T=new Map;let D,L=0;function j(e,t,n,r,o,i,a,s=0){const l=16.666/r;let c="{\n";for(let e=0;e<=1;e+=l){const r=t+(n-t)*i(e);c+=100*e+`%{${a(r,1-r)}}\n`}const u=c+`100% {${a(n,1-n)}}\n}`,d=`__svelte_${(e=>{let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0})(u)}_${s}`,f=b(e),{stylesheet:p,rules:h}=T.get(f)||((e,t)=>{const n={stylesheet:v(t),rules:{}};return T.set(e,n),n})(f,e);h[d]||(h[d]=!0,p.insertRule(`@keyframes ${d} ${u}`,p.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${r}ms linear ${o}ms 1 both`,L+=1,d}function P(e){D=e}function q(){if(!D)throw new Error("Function called outside component initialization");return D}function B(e){q().$$.on_mount.push(e)}function N(e){q().$$.on_destroy.push(e)}function U(){const e=q();return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=O(t,n);r.slice().forEach((t=>{t.call(e,o)}))}}}const I=[],R=[],H=[],F=[],K=Promise.resolve();let z=!1;function Y(){z||(z=!0,K.then(Z))}function W(e){H.push(e)}const G=new Set;let J,X=0;function Z(){const e=D;do{for(;X<I.length;){const e=I[X];X++,P(e),V(e.$$)}for(P(null),I.length=0,X=0;R.length;)R.pop()();for(let e=0;e<H.length;e+=1){const t=H[e];G.has(t)||(G.add(t),t())}H.length=0}while(I.length);for(;F.length;)F.pop()();z=!1,G.clear(),P(e)}function V(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(W)}}function Q(e,t,n){e.dispatchEvent(O(`${t?"intro":"outro"}${n}`))}const ee=new Set;let te;function ne(){te={r:0,c:[],p:te}}function re(){te.r||i(te.c),te=te.p}function oe(e,t){e&&e.i&&(ee.delete(e),e.i(t))}function ie(e,t,n,r){if(e&&e.o){if(ee.has(e))return;ee.add(e),te.c.push((()=>{ee.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}const ae={duration:0};function se(e,r,o,s){let l=r(e,o),c=s?0:1,u=null,d=null,g=null;function y(){g&&function(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),L-=o,L||p((()=>{L||(T.forEach((e=>{const{stylesheet:t}=e;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.rules={}})),T.clear())})))}(e,g)}function b(e,t){const n=e.b-c;return t*=Math.abs(n),{a:c,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function v(r){const{delay:o=0,duration:a=300,easing:s=n,tick:v=t,css:w}=l||ae,x={start:f()+o,b:r};r||(x.group=te,te.r+=1),u||d?d=x:(w&&(y(),g=j(e,c,r,a,o,s,w)),r&&v(0,1),u=b(x,a),W((()=>Q(e,r,"start"))),(e=>{let t;0===h.size&&p(m),new Promise((n=>{h.add(t={c:e,f:n})}))})((t=>{if(d&&t>d.start&&(u=b(d,a),d=null,Q(e,u.b,"start"),w&&(y(),g=j(e,c,u.b,u.duration,0,s,l.css))),u)if(t>=u.end)v(c=u.b,1-c),Q(e,u.b,"end"),d||(u.b?y():--u.group.r||i(u.group.c)),u=null;else if(t>=u.start){const e=t-u.start;c=u.a+u.d*s(e/u.duration),v(c,1-c)}return!(!u&&!d)})))}return{run(e){a(l)?(J||(J=Promise.resolve(),J.then((()=>{J=null}))),J).then((()=>{l=l(),v(e)})):v(e)},end(){y(),u=d=null}}}function le(e,t){ie(e,1,1,(()=>{t.delete(e.key)}))}function ce(e){e&&e.c()}function ue(e,t,n,o){const{fragment:s,on_mount:l,on_destroy:c,after_update:u}=e.$$;s&&s.m(t,n),o||W((()=>{const t=l.map(r).filter(a);c?c.push(...t):i(t),e.$$.on_mount=[]})),u.forEach(W)}function de(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function fe(e,n,r,a,s,l,c,u=[-1]){const d=D;P(e);const f=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:s,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:o(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};c&&c(f.root);let p=!1;if(f.ctx=r?r(e,n.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&s(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),p&&((e,t)=>{-1===e.$$.dirty[0]&&(I.push(e),Y(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31})(e,t)),n})):[],f.update(),p=!0,i(f.before_update),f.fragment=!!a&&a(f.ctx),n.target){if(n.hydrate){const e=(e=>Array.from(e.childNodes))(n.target);f.fragment&&f.fragment.l(e),e.forEach($)}else f.fragment&&f.fragment.c();n.intro&&oe(e.$$.fragment),ue(e,n.target,n.anchor,n.customElement),Z()}P(d)}class pe{$destroy(){de(this,1),this.$destroy=t}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var he="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function me(e){var t={exports:{}};return e(t,t.exports),t.exports}var ge=me((function(e,t){e.exports=function(){var e=6e4,t=36e5,n="millisecond",r="second",o="minute",i="hour",a="day",s="week",l="month",c="quarter",u="year",d="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},g=(e,t,n)=>{var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},y={s:g,z:e=>{var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),o=n%60;return(t<=0?"+":"-")+g(r,2,"0")+":"+g(o,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),o=t.clone().add(r,l),i=n-o<0,a=t.clone().add(r+(i?-1:1),l);return+(-(r+(n-o)/(i?o-a:a-o))||0)},a:e=>e<0?Math.ceil(e)||0:Math.floor(e),p:e=>({M:l,y:u,w:s,d:a,D:d,h:i,m:o,s:r,ms:n,Q:c}[e]||String(e||"").toLowerCase().replace(/s$/,"")),u:e=>void 0===e},b="en",v={};v[b]=m;var w=e=>e instanceof _,x=function e(t,n,r){var o;if(!t)return b;if("string"==typeof t){var i=t.toLowerCase();v[i]&&(o=i),n&&(v[i]=n,o=i);var a=t.split("-");if(!o&&a.length>1)return e(a[0])}else{var s=t.name;v[s]=t,o=s}return!r&&o&&(b=o),o||!r&&b},$=function(e,t){if(w(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new _(n)},k=y;k.l=x,k.i=w,k.w=(e,t)=>$(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset});var _=function(){function m(e){this.$L=x(e.locale,null,!0),this.parse(e)}var g=m.prototype;return g.parse=function(e){this.$d=(e=>{var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(k.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(p);if(r){var o=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],o,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],o,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(t)})(e),this.$x=e.x||{},this.init()},g.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},g.$utils=()=>k,g.isValid=function(){return!(this.$d.toString()===f)},g.isSame=function(e,t){var n=$(e);return this.startOf(t)<=n&&n<=this.endOf(t)},g.isAfter=function(e,t){return $(e)<this.startOf(t)},g.isBefore=function(e,t){return this.endOf(t)<$(e)},g.$g=function(e,t,n){return k.u(e)?this[t]:this.set(n,e)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(e,t){var n=this,c=!!k.u(t)||t,f=k.p(e),p=(e,t)=>{var r=k.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return c?r:r.endOf(a)},h=(e,t)=>k.w(n.toDate()[e].apply(n.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(t)),n),m=this.$W,g=this.$M,y=this.$D,b="set"+(this.$u?"UTC":"");switch(f){case u:return c?p(1,0):p(31,11);case l:return c?p(1,g):p(0,g+1);case s:var v=this.$locale().weekStart||0,w=(m<v?m+7:m)-v;return p(c?y-w:y+(6-w),g);case a:case d:return h(b+"Hours",0);case i:return h(b+"Minutes",1);case o:return h(b+"Seconds",2);case r:return h(b+"Milliseconds",3);default:return this.clone()}},g.endOf=function(e){return this.startOf(e,!1)},g.$set=function(e,t){var s,c=k.p(e),f="set"+(this.$u?"UTC":""),p=(s={},s[a]=f+"Date",s[d]=f+"Date",s[l]=f+"Month",s[u]=f+"FullYear",s[i]=f+"Hours",s[o]=f+"Minutes",s[r]=f+"Seconds",s[n]=f+"Milliseconds",s)[c],h=c===a?this.$D+(t-this.$W):t;if(c===l||c===u){var m=this.clone().set(d,1);m.$d[p](h),m.init(),this.$d=m.set(d,Math.min(this.$D,m.daysInMonth())).$d}else p&&this.$d[p](h);return this.init(),this},g.set=function(e,t){return this.clone().$set(e,t)},g.get=function(e){return this[k.p(e)]()},g.add=function(n,c){var d,f=this;n=Number(n);var p=k.p(c),h=e=>{var t=$(f);return k.w(t.date(t.date()+Math.round(e*n)),f)};if(p===l)return this.set(l,this.$M+n);if(p===u)return this.set(u,this.$y+n);if(p===a)return h(1);if(p===s)return h(7);var m=(d={},d[o]=e,d[i]=t,d[r]=1e3,d)[p]||1,g=this.$d.getTime()+n*m;return k.w(g,this)},g.subtract=function(e,t){return this.add(-1*e,t)},g.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=e||"YYYY-MM-DDTHH:mm:ssZ",o=k.z(this),i=this.$H,a=this.$m,s=this.$M,l=n.weekdays,c=n.months,u=(e,n,o,i)=>e&&(e[n]||e(t,r))||o[n].slice(0,i),d=e=>k.s(i%12||12,e,"0"),p=n.meridiem||((e,t,n)=>{var r=e<12?"AM":"PM";return n?r.toLowerCase():r}),m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:k.s(s+1,2,"0"),MMM:u(n.monthsShort,s,c,3),MMMM:u(c,s),D:this.$D,DD:k.s(this.$D,2,"0"),d:String(this.$W),dd:u(n.weekdaysMin,this.$W,l,2),ddd:u(n.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(i),HH:k.s(i,2,"0"),h:d(1),hh:d(2),a:p(i,a,!0),A:p(i,a,!1),m:String(a),mm:k.s(a,2,"0"),s:String(this.$s),ss:k.s(this.$s,2,"0"),SSS:k.s(this.$ms,3,"0"),Z:o};return r.replace(h,((e,t)=>t||m[e]||o.replace(":","")))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(n,d,f){var p,h=k.p(d),m=$(n),g=(m.utcOffset()-this.utcOffset())*e,y=this-m,b=k.m(this,m);return b=(p={},p[u]=b/12,p[l]=b,p[c]=b/3,p[s]=(y-g)/6048e5,p[a]=(y-g)/864e5,p[i]=y/t,p[o]=y/e,p[r]=y/1e3,p)[h]||y,f?b:k.a(b)},g.daysInMonth=function(){return this.endOf(l).$D},g.$locale=function(){return v[this.$L]},g.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=x(e,t,!0);return r&&(n.$L=r),n},g.clone=function(){return k.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},m}(),S=_.prototype;return $.prototype=S,[["$ms",n],["$s",r],["$m",o],["$H",i],["$W",a],["$M",l],["$y",u],["$D",d]].forEach((function(e){S[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),$.extend=(e,t)=>(e.$i||(e(t,_,$),e.$i=!0),$),$.locale=x,$.isDayjs=w,$.unix=e=>$(1e3*e),$.en=v[b],$.Ls=v,$.p={},$}()}));const ye=(e,t,n)=>new Promise(((r,o)=>{if(n=Object.assign({concurrency:1/0},n),"function"!=typeof t)throw new TypeError("Mapper function is required");const{concurrency:i}=n;if(!("number"==typeof i&&i>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${i}\` (${typeof i})`);const a=[],s=e[Symbol.iterator]();let l=!1,c=!1,u=0,d=0;const f=()=>{if(l)return;const e=s.next(),n=d;if(d++,e.done)return c=!0,void(0===u&&r(a));u++,Promise.resolve(e.value).then((e=>t(e,n))).then((e=>{a[n]=e,u--,f()}),(e=>{l=!0,o(e)}))};for(let e=0;e<i&&(f(),!c);e++);}));var be=ye,ve=ye;be.default=ve;const we=[],xe={"&amp;":"＆","&lt;":"＜","&gt;":"＞","&quot;":'"',"&apos;":"'","&nbsp;":" "};function $e(e){if(!e||e===!!e||e===+e)return String(e);if(e.constructor===String)return e;if(e.hasOwnProperty("toString")||"symbol"==typeof e)return e.toString();if(e.hasOwnProperty("toJSON"))return JSON.stringify(e,null,"  ");const t=e.message?$e(e.message):JSON.stringify(e,null,"  "),n=e.name||e.constructor.name;return n&&"Object"!=n&&"Error"!=n?n+": "+t:t}const ke=/[\/\?<>\\:\*\|"]/g,_e=/[\x00-\x1f\x80-\x9f]/g,Se=/^\.+$/,Ae=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,Ee=/[\. ]+$/;function Me(e){return e.replace(ke,"-").replace(_e,"-").replace(Se,"-").replace(Ae,"-").replace(Ee,"-")}const Oe=new TextEncoder;async function Ce(e){const t=new Uint8Array(await crypto.subtle.digest("SHA-256",e.constructor===String?Oe.encode(e):e));return"_"+btoa(String.fromCharCode.apply(null,t)).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}function Te(e,n){return n(((e,n=t)=>{let r;const o=new Set;function i(t){if(s(e,t)&&(e=t,r)){const t=!we.length;for(const t of o)t[1](),we.push(t,e);if(t){for(let e=0;e<we.length;e+=2)we[e][0](we[e+1]);we.length=0}}}return{set:i,update:t=>{i(t(e))},subscribe:(a,s=t)=>{const l=[a,s];return o.add(l),1===o.size&&(r=n(i)||t),a(e),()=>{o.delete(l),0===o.size&&(r(),r=null)}}}})(e))}const De=Te(new Set,(({subscribe:e,update:t})=>({subscribe:e,remove:e=>t((t=>(t.delete(e),t))),add:e=>t((t=>t.add($e(e)))),clear:()=>t((e=>(e.clear(),e)))}))),Le=Te(0,(({subscribe:e,set:t})=>{let n=0,r=0;return{subscribe:e,set total(e){n=e},inc:()=>t(100*++r/n|0),clear:()=>r&&t(n=r=0)}})),je=[{mime:"image/webp",ext:".webp",pattern:[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80,86,80]},{mime:"image/png",ext:".png",pattern:[137,80,78,71]},{mime:"image/gif",ext:".gif",pattern:[71,73,70,56]},{mime:"image/jpeg",ext:".jpg",pattern:[255,216,255]},{mime:"image/bmp",ext:".bmp",pattern:[66,77]}];function Pe(e,t){const n=atob(t?e.substr(t):e),r=n.length,o=new Uint8Array(r);for(let e=0;e<r;++e)o[e]=n.charCodeAt(e);return o}function qe(e){e.constructor===String&&(e=Pe(e,19));const t=je.find((t=>t.pattern.every(((t,n)=>!t||e[n]===t))));if(!t)throw"Unsupported image type";return t}function Be(e,t){const n=e.getElementsByTagName(t);return n[Symbol.iterator]?n:Array.from(n)}function Ne(e){const t=history[e];return Object.assign((function(){try{return t.apply(this,arguments)}finally{window.dispatchEvent(new Event(e))}}),{destroy(){history[e]=t}})}async function Ue(e,t,n="GET",r){const o=await fetch(e,{method:n,credentials:"include",signal:t,body:r,headers:{"x-requested-with":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}});return 200===o.status?Ye(await o.text()):null}function Ie(e){return{name:e.statusText,message:e.status}}function Re(e){return async(t,n)=>{const r=await fetch(e+t,{credentials:"include",signal:n,headers:{"x-requested-with":"XMLHttpRequest"}});if(r.status>=400)throw Ie(r);return r.json()}}async function He(e,t){const n=new Uint8Array(await t.arrayBuffer());let r;return{...qe(n),url:e,id:await Ce(n),b64:()=>r||(r=new Promise(((e,n)=>{const r=new FileReader;r.onloadend=()=>{try{if(2==r.readyState){const t=r.result;e(t.slice(t.indexOf(",")+1))}else n(r.error)}catch(e){n(e)}},r.readAsDataURL(t)}))),data:()=>n}}const Fe="undefined"!=typeof GM_xmlhttpRequest?GM_xmlhttpRequest:GM.xmlHttpRequest,Ke=/^\s*data:([image\/jpnfwbpsv]+);base64/;async function ze(e,t,n,r){try{if(n.has(t))return n.get(t);e=(e||"").trim();let o=await(Ke.test(t)?(async e=>{const t=e.slice(e.indexOf(",")+1);return{...qe(t),url:e,id:await Ce(e),b64:()=>t,data:()=>Pe(t)}})(t):(async(e,t,n)=>{let r=new AbortController;const o=()=>{n.removeEventListener("abort",o),r.abort()};n.addEventListener("abort",o,{once:!0});try{if(location.host!==new URL(e).host&&Fe){const{finalUrl:n,response:o}=await new Promise(((n,o)=>{function i(e){o(e),r.signal.removeEventListener("abort",a),a()}const{abort:a}=Fe({url:e,method:"GET",responseType:"blob",headers:{Referer:location.href},onprogress:n=>t.has(e)?i({name:"Exist",url:e}):t.has(n.finalUrl)?i({name:"Exist",url:n.finalUrl}):void 0,onabort(){i({name:"AbortError"})},onerror(e){i(e.error)},onload(e){e.status>=400?i(Ie(e)):(r.signal.removeEventListener("abort",a),n(e))}});r.signal.addEventListener("abort",a,{once:!0})}));return await He(n,o)}{const n=await fetch(e,{credentials:"include",cache:"force-cache",referrer:location.href,signal:r.signal});if(t.has(e))return t.get(e);if(n.status>=400)throw Ie(n);return t.has(n.url)?t.get(n.url):await He(n.url,await n.blob())}}catch(e){if("Exist"===(null==e?void 0:e.name))return t.get(e.url);throw e}finally{o()}})(t,n,r.signal));if(o)return o=n.get(o.id)||o,n.set(t,o),n.set(o.id,o),n.set(o.url,o),o;if(n.has(t))return n.get(t)}catch(n){"AbortError"!=(null==n?void 0:n.name)&&(console.error(n),De.add(`Ошибка загрузки изображения\n${t}\n${e?`в главе\n"${e}"\n`:""}${$e(n)}`))}}function Ye(e,t){const n=(new DOMParser).parseFromString(e,t||"text/html"),r=n.querySelector("parsererror");if(r)throw r.textContent;return n}function We(e,t,n){const r=e.createElementNS(t.namespaceURI,n);for(;t.firstChild;)r.appendChild(t.firstChild);t.parentNode.replaceChild(r,t)}function Ge(e){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.remove()}function Je(e,t,...n){const r=n.filter((e=>e!=t)).join(",");r&&e.querySelectorAll(r).forEach((n=>We(e,n,t)))}const Xe={image:"image",emphasis:"emphasis",strong:"strong",strikethrough:"strikethrough",underline:"strong",blockquote:"cite"},Ze={image:"img",emphasis:"i",strong:"b",strikethrough:"s",underline:"u",blockquote:"blockquote"};function Ve(e){return e?e.replace(/"/g,"'"):null}async function Qe(e,t,n,r,o){let i=Ye(e=e.replace(/(\s*<br(\s+[^\/<>]+)?\/?>\s*)+/g,"</p><p>"));try{const{blockquote:a}=Ze;if(i.querySelectorAll(".message-delete,.splitnewsnavigation,script,.adblock-service"+(o?"":",img")).forEach((e=>e.remove())),Je(i,n.emphasis,"i","em","dfn","var","q","dd","address"),Je(i,n.strong,"b","strong","mark","h2","h3","h4","h5","h6"),Je(i,n.strikethrough,"s","strike","del"),Je(i,n.underline,"u","ins","abbr"),i.querySelectorAll(".game-message,.quote").forEach((e=>We(i,e,a))),i.querySelectorAll("section section").forEach(Ge),i.querySelectorAll(`body :not(header):not(section):not(${n.emphasis}):not(${n.strong}):not(${n.strikethrough}):not(${n.underline}):not(${a}):not(sub):not(sup):not(img):not(h1):not(a):not([id])`).forEach((e=>{"SECTION"!==e.parentElement.tagName&&getComputedStyle(e).display.includes("inline")?Ge(e):We(i,e,"div")})),e=i.documentElement.outerHTML,i.open(),i=Ye(e.replace(/<\/?div>/g,"</p><p>").replace(/<(\/)?blockquote>/g,`</p><$1${a}><p>`)),o){const e=n===Ze&&i.querySelector("header").textContent;await be(Array.from(i.querySelectorAll("img")),(async r=>{let a=await ze(e||r.closest("section").querySelector("header").textContent,r.src,o,t);if(a){const e=Ve(r.alt),t=Ve(r.title),o=i.createElement(n.image);e&&o.setAttribute("alt",e),n===Xe?(await a.b64(),o.setAttribute("l:href","#"+a.id),r.parentNode.replaceChild(o,r),"SECTION"===o.parentElement.tagName&&(t&&(o.title=t),o.id=a.id)):n===Ze&&(o.src="images/"+a.id+a.ext,t&&(o.title=t),o.id=a.id,r.parentNode.replaceChild(o,r))}else r.remove()}),{concurrency:r})}if(i.querySelectorAll(`body :not(${n.image})`).forEach(et),Je(i,n.blockquote,a),e=i.body.innerHTML,i.open(),e=((e,t)=>{let n;return t.replace(/&#?[\w\d]+;/g,(t=>{if(t in xe)return xe[t];if("#"===t[1]){const e=parseInt(t.slice(2),"x"===t[2]?16:10);switch(e){case 38:return"＆";case 60:return"＜";case 62:return"＞";case 160:return" ";default:if(e<=1114111)return String.fromCodePoint(e)}}return n||(e.title="",n=e.head.querySelector("title")),n.innerHTML=t,n.innerText}))})(i,e),e=e.replace(/(\s*<p>\s*<\/p>\s*)+/g," "),n===Xe)return e=e.replace(/<(\/)?header>/g,"<$1title>"),o?e.replace(/><\/image>/g,"/>"):e;if(n===Ze)return o?e.replace(/(<img[^>]+)>/gi,"$1/>"):e}finally{i.open()}}function et(e){let t=["id","href"],n=0;for(;e.attributes.length!=n;)t.includes(e.attributes.item(n).name)?++n:e.removeAttribute(e.attributes.item(n).name)}function tt(e,t){return t.appendChild(e),{update(n){n!=t&&(t=n).appendChild(e)},destroy(){e.remove()}}}function*nt(e){for(const[t,n]of e)t===n.id&&(yield n)}const rt={янв:"jan",фев:"feb",мар:"mar",апр:"apr",мая:"may",июн:"jun",июл:"jul",авг:"aug",сен:"sep",окт:"oct",ноя:"nov",дек:"dec"};function ot(e){return ge(e.replace(/(янв|фев|мар|апр|мая|июн|июл|авг|сен|окт|ноя|дек)[а-я]*/i,((e,t)=>rt[t])).replace(/[^\w:\+\s]+/g,"").replace(/\s+/g," "))}class it{constructor(){this.programName="ranobe-ebook-loader 0.2.8",this.homePage=location.href}date(e){return this.d.format(e)}get isoDate(){return this.d.toISOString().replace(".000","")}extractTitle(e){return e.querySelector("h1").firstChild.textContent}}const at=Re("https://xn--80ac9aeh6f.xn--p1ai/api/v2/books/");class st extends it{constructor(){super(...arguments),this.bookAlias=location.pathname.split("/",2).find(Boolean),this.homePage=`https://xn--80ac9aeh6f.xn--p1ai/${this.bookAlias}/`}static get injectTarget(){return document.getElementsByClassName("BookPageActions__actions")[0]}async parts(e,t,n){const{fullTitle:r,titleEn:o,genres:i,author:a,description:s,createTime:l,title:c,images:u,country:d}=await at(this.bookAlias,e.signal);this.covers=[u.vertical.find((e=>"bookMain"===e.processor)).url],this.d=ge(l),this.genres=i.map((e=>e.title)),this.title=c,this.subtitle=[r,o].filter(Boolean).join(" • "),this.description=s||"",this.lang=null==d?void 0:d.code,this.authors=[a].filter(Boolean);const{bookAlias:f}=this,p=(await at(f+"/chapters",e.signal)).items.filter((e=>e.hasUserPaid||"free"===e.availabilityStatus)).reverse();return Le.total=p.length,be(p,(async({slug:r})=>{try{const{title:o,text:{text:i}}=await at(f+"/chapters/"+r,e.signal);if(i.includes("<img ")){const n=Ye(i);for(const r of Be(n,"img"))await ze(o,r.src,t,e);n.open()}return Le.inc(),n?await n({title:o,text:i}):{title:o,text:i}}catch(t){throw e.abort(),t}}),{concurrency:5})}}st.spa=!0,st.component="Link Link_size_md Link_bordered Link_hover_filled BookPageActions__action",st.color=e=>`rgba(48,55,69,${e})`;class lt extends it{static get injectTarget(){return document.getElementById("mc-fs-rate")}async parts(e,t,n){const r=this.bookAlias=document.querySelector(".r-fullstory-chapters-foot > a:nth-child(3n)").href.split("/",5).slice(-1)[0];this.covers=[document.querySelector('[itemprop="image"]').href],this.d=ge(document.querySelector('[itemprop="datePublished"]').getAttribute("content")),this.genres=Array.from(document.querySelectorAll('[itemprop="genre"] a'),(e=>e.textContent)),this.keywords=Array.from(document.querySelectorAll('[itemprop="keywords"] a'),(e=>e.textContent)).join(", "),this.title=this.extractTitle(document),this.subtitle=document.querySelector('[itemprop="alternateName"]').textContent,this.description=document.querySelector('[itemprop="description"]').innerHTML,this.authors=Array.from(document.querySelectorAll('[itemprop="creator"] a'),(e=>({name:e.textContent,homePage:e.href})));const o=[];for(let t=1;;++t){const n=await Ue(`https://ranobes.com/chapters/${r}/page/${t}/`,e.signal);if(!n)break;n.querySelectorAll(`.cat_block a[href^="https://ranobes.com/chapters/${r}/"]`).forEach((e=>o.push(e.href)))}return Le.total=o.length,be(o.reverse(),(async o=>{try{let i="",a="";const s=[o];for(const n of s){const o=await Ue(n,e.signal);if(!o)break;const l=o.getElementById("arrticle");if(i+=l.outerHTML,!a){a=this.extractTitle(o);const e=o.querySelector(".splitnewsnavigation");e&&e.querySelectorAll(`a[href^="https://ranobes.com/chapters/${r}/"]`).forEach((e=>s.push(e.href)))}for(const n of Be(l,"img"))await ze(a,n.src,t,e);o.open()}return Le.inc(),n?await n({title:a,text:i}):{title:a,text:i}}catch(t){throw e.abort(),t}}),{concurrency:5})}}lt.component="btn btn-block",lt.color=e=>`rgba(149,172,124,${e})`;const ct=Re("");class ut extends it{constructor(){super(...arguments),this.chapterElements=Array.from(document.querySelectorAll("#Chapters .btn-info"))}static get injectTarget(){return document.querySelector("#Info > .btn-toolbar")}async parts(e,t,n){const r=document.getElementById("Info");this.covers=Array.from(r.querySelectorAll(".slick img"),(e=>e.src));const o=this.covers.find((e=>/\.jpe?g($|\?)/i.test(e)));return o&&this.covers.unshift(o),this.covers=Array.from(new Set(this.covers)),this.d=ot(this.chapterElements[this.chapterElements.length-1].parentElement.previousElementSibling.previousElementSibling.firstElementChild.getAttribute("title")),this.genres=Array.from(r.querySelectorAll('a[href^="/search?genres"]'),(e=>e.textContent)),this.keywords=Array.from(r.querySelectorAll('a[href^="/search?tags"]'),(e=>e.textContent)).join(", "),this.subtitle=this.extractTitle(document),this.title=this.subtitle.substring(this.subtitle.lastIndexOf(" / ")+3),this.description=r.querySelector(".btn-toolbar + div").innerHTML,this.authors=Array.from(r.querySelectorAll('a[href^="/search?from=book&t="]')).filter((e=>"Автор:"===e.parentElement.previousElementSibling.textContent)).map((e=>({name:e.textContent,homePage:e.href}))),this.bookAlias=Me(this.title),Le.total=this.chapterElements.length,be(this.chapterElements.map((e=>e.href)),(async r=>{try{let{title:o,content:i}=await ct(r.replace(/_new$/,"")+"ajax?is_new=true",e.signal);if(i=i.split(/<div class="content-text" style="word-wrap: break-word;">|<p>https?:\/\/tl\.rulate\.ru\/book\//,3)[1],i.includes("<img ")){const n=Ye(i);for(const r of Be(n,"img"))await ze(o,r.src,t,e);n.open()}return Le.inc(),n?await n({title:o,text:i}):{title:o,text:i}}catch(t){throw e.abort(),t}}),{concurrency:5})}}ut.component="btn btn-info",ut.color=e=>`rgba(0,85,128,${e})`;class dt extends it{static get injectTarget(){return document.getElementsByClassName("link-last-first-chapter")[0]}async parts(e,t,n){var r,o,i;const a=document.getElementsByClassName("box-book")[0];this.covers=Array.from(a.querySelectorAll(".img-book img"),(e=>e.src)),this.d=ot(a.querySelector(".date-home").textContent);const s=Array.from(document.querySelectorAll("#info-book > p"),(e=>e.textContent));this.genres=(null===(o=null===(r=s.find((e=>e.startsWith("Жанры: "))))||void 0===r?void 0:r.substr(7))||void 0===o?void 0:o.split(", "))||[],this.keywords="",this.title=this.extractTitle(document),this.subtitle=[this.title,null===(i=s.find((e=>e.startsWith("Название: "))))||void 0===i?void 0:i.substr(10)].filter(Boolean).join(" • "),this.description=a.querySelector("#desc-tab").innerHTML,this.authors=s.filter((e=>e.startsWith("Автор: "))).map((e=>({name:e.substr(7)}))),this.bookAlias=Me(this.title);const l=a.querySelector(".like-but").id,c=await Ue("https://jaomix.ru/wp-admin/admin-ajax.php",e.signal,"POST",new URLSearchParams({action:"toc",selectall:l}).toString()),u=(await be(Be(c,"option"),(async({value:t})=>{if("0"===t)return Array.from(document.getElementById("open-0").getElementsByTagName("a"),(e=>e.href));{const n=await Ue("https://jaomix.ru/wp-admin/admin-ajax.php",e.signal,"POST",new URLSearchParams({action:"toc",page:t,termid:l}).toString());try{return Array.from(n.getElementsByTagName("a"),(e=>e.href))}finally{n.open()}}}),{concurrency:5})).flat().reverse();return c.open(),Le.total=u.length,be(u,(async r=>{try{const o=await Ue(r,e.signal),i=this.extractTitle(o),a=o.getElementsByClassName("entry")[0];for(const n of Be(a,"img"))await ze(i,n.src,t,e);const s=a.outerHTML;return o.open(),Le.inc(),n?await n({title:i,text:s}):{title:i,text:s}}catch(t){throw e.abort(),t}}),{concurrency:5})}}dt.component="lie-but",dt.color=e=>`rgba(51,51,51,${e})`;const ft=(e=>{var t=Object.prototype.hasOwnProperty;function n(e,r){return Array.isArray(e)?((e,t)=>{for(var r,o="",i="",s=Array.isArray(t),l=0;l<e.length;l++)(r=n(e[l]))&&(s&&t[l]&&(r=a(r)),o=o+i+r,i=" ");return o})(e,r):e&&"object"==typeof e?(e=>{var n="",r="";for(var o in e)o&&e[o]&&t.call(e,o)&&(n=n+r+o,r=" ");return n})(e):e||""}function r(e){if(!e)return"";if("object"==typeof e){var n="";for(var r in e)t.call(e,r)&&(n=n+r+":"+e[r]+";");return n}return e+""}function o(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var o=typeof t;return"object"!==o&&"function"!==o||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=a(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}e.merge=function e(t,n){if(1===arguments.length){for(var o=t[0],i=1;i<t.length;i++)o=e(o,t[i]);return o}for(var a in n)if("class"===a){var s=t[a]||[];t[a]=(Array.isArray(s)?s:[s]).concat(n[a]||[])}else if("style"===a){s=(s=r(t[a]))&&";"!==s[s.length-1]?s+";":s;var l=r(n[a]);l=l&&";"!==l[l.length-1]?l+";":l,t[a]=s+l}else t[a]=n[a];return t},e.classes=n,e.style=r,e.attr=o,e.attrs=(e,i)=>{var a="";for(var s in e)if(t.call(e,s)){var l=e[s];if("class"===s){a=o(s,l=n(l),!1,i)+a;continue}"style"===s&&(l=r(l)),a+=o(s,l,!1,i)}return a};var i=/["&<>]/;function a(e){var t=""+e,n=i.exec(t);if(!n)return e;var r,o,a,s="";for(r=n.index,o=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}o!==r&&(s+=t.substring(o,r)),o=r+1,s+=a}return o!==r?s+t.substring(o,r):s}return e.escape=a,e.rethrow=function e(t,n,r,o){if(!(t instanceof Error))throw t;if(!("undefined"==typeof window&&n||o))throw t.message+=" on line "+r,t;try{o=o||require("fs").readFileSync(n,"utf8")}catch(n){e(t,null,r)}var i=3,a=o.split("\n"),s=Math.max(r-i,0),l=Math.min(a.length,r+i);throw i=a.slice(s,l).map(((e,t)=>{var n=t+s+1;return(n==r?"  > ":"    ")+n+"| "+e})).join("\n"),t.path=n,t.message=(n||"Pug")+":"+r+"\n"+i+"\n\n"+t.message,t},e})({});function pt(e){var t,n="",r=e||{};return function(e,r,o,i,a,s,l,c,u,d,f,p){n+="<description><title-info>",(()=>{var e=s;if("number"==typeof e.length)for(var r=0,o=e.length;r<o;r++){var i=e[r];n=n+"<genre>"+ft.escape(null==(t=i)?"":t)+"</genre>"}else for(var r in o=0,e)o++,i=e[r],n=n+"<genre>"+ft.escape(null==(t=i)?"":t)+"</genre>"}).call(this),(()=>{var e=r;if("number"==typeof e.length)for(var o=0,i=e.length;o<i;o++){var a=e[o];n=n+"<author><first-name>"+ft.escape(null==(t=a.name)?"":t)+"</first-name><last-name/>",a.homePage&&(n=n+"<home-page>"+ft.escape(null==(t=a.homePage)?"":t)+"</home-page>"),n+="</author>"}else for(var o in i=0,e)i++,a=e[o],n=n+"<author><first-name>"+ft.escape(null==(t=a.name)?"":t)+"</first-name><last-name/>",a.homePage&&(n=n+"<home-page>"+ft.escape(null==(t=a.homePage)?"":t)+"</home-page>"),n+="</author>"}).call(this),n=n+"<book-title>"+ft.escape(null==(t=p)?"":t)+"</book-title>",e&&(n=n+"<annotation>"+(null==(t=e)?"":t)+"</annotation>"),c&&(n=n+"<keywords>"+ft.escape(null==(t=c)?"":t)+"</keywords>"),i&&(n+='<coverpage><image l:href="#cover"/></coverpage>'),n+="<lang>ru</lang>",u&&(n=n+"<src-lang>"+ft.escape(null==(t=u)?"":t)+"</src-lang>"),n+="</title-info><document-info>",(()=>{var e=r;if("number"==typeof e.length)for(var o=0,i=e.length;o<i;o++){var a=e[o];n=n+"<author><first-name>"+ft.escape(null==(t=a.name)?"":t)+"</first-name><last-name/>",a.homePage&&(n=n+"<home-page>"+ft.escape(null==(t=a.homePage)?"":t)+"</home-page>"),n+="</author>"}else for(var o in i=0,e)i++,a=e[o],n=n+"<author><first-name>"+ft.escape(null==(t=a.name)?"":t)+"</first-name><last-name/>",a.homePage&&(n=n+"<home-page>"+ft.escape(null==(t=a.homePage)?"":t)+"</home-page>"),n+="</author>"}).call(this),n=n+"<program-used>"+(null==(t=d)?"":t)+"</program-used><date"+ft.attr("value",f,!1,!0)+">"+(null==(t=a)?"":t)+"</date><src-url>"+ft.escape(null==(t=l)?"":t)+"</src-url><id>"+ft.escape(null==(t=o)?"":t)+"</id><version>1</version></document-info></description>"}.call(this,"annotation"in r?r.annotation:"undefined"!=typeof annotation?annotation:void 0,"authors"in r?r.authors:"undefined"!=typeof authors?authors:void 0,"bookAlias"in r?r.bookAlias:"undefined"!=typeof bookAlias?bookAlias:void 0,"cover"in r?r.cover:"undefined"!=typeof cover?cover:void 0,"fullDate"in r?r.fullDate:"undefined"!=typeof fullDate?fullDate:void 0,"genres"in r?r.genres:"undefined"!=typeof genres?genres:void 0,"homePage"in r?r.homePage:"undefined"!=typeof homePage?homePage:void 0,"keywords"in r?r.keywords:"undefined"!=typeof keywords?keywords:void 0,"lang"in r?r.lang:"undefined"!=typeof lang?lang:void 0,"programName"in r?r.programName:"undefined"!=typeof programName?programName:void 0,"shortDate"in r?r.shortDate:"undefined"!=typeof shortDate?shortDate:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}function ht(e){var t,n="",r=e||{};return function(e,r){n=n+"<!DOCTYPE html><body><header><p>"+ft.escape(null==(t=r)?"":t)+"</p></header>",(()=>{var r=e;if("number"==typeof r.length)for(var o=0,i=r.length;o<i;o++){var a=r[o];n=n+"<section><header><p>"+ft.escape(null==(t=a.title)?"":t)+"</p></header>"+(null==(t=a.text)?"":t)+"</section>"}else for(var o in i=0,r)i++,a=r[o],n=n+"<section><header><p>"+ft.escape(null==(t=a.title)?"":t)+"</p></header>"+(null==(t=a.text)?"":t)+"</section>"}).call(this),n+="</body>"}.call(this,"chapters"in r?r.chapters:"undefined"!=typeof chapters?chapters:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}function mt(e){var t,n="",r=e||{};return function(e,r,o,i,a){n=n+'<?xml version="1.0" encoding="utf-8" ?><ncx version="2005-1" xmlns="http://www.daisy.org/z3986/2005/ncx/"><head><meta name="dtb:uid"'+ft.attr("content",a,!1,!1)+'></meta><meta name="dtb:generator"'+ft.attr("content",o,!1,!1)+'></meta><meta name="dtb:depth" content="1"></meta><meta name="dtb:totalPageCount" content="0"></meta><meta name="dtb:maxPageNumber" content="0"></meta></head><docTitle><text>'+ft.escape(null==(t=i)?"":t)+"</text></docTitle>",(()=>{var r=e;if("number"==typeof r.length)for(var o=0,i=r.length;o<i;o++){var a=r[o];n=n+"<docAuthor><text>"+ft.escape(null==(t=a.name)?"":t)+"</text></docAuthor>"}else for(var o in i=0,r)i++,a=r[o],n=n+"<docAuthor><text>"+ft.escape(null==(t=a.name)?"":t)+"</text></docAuthor>"}).call(this),n+="<navMap>",(()=>{var e=r;if("number"==typeof e.length)for(var o=0,i=e.length;o<i;o++){var a=e[o];n=n+'<navPoint class="chapter"'+ft.attr("playOrder",o+1,!1,!1)+ft.attr("id",a.id,!1,!1)+"><navLabel><text>"+ft.escape(null==(t=a.title)?"":t)+"</text></navLabel><content"+ft.attr("src",a.id+".xhtml",!1,!1)+"></content></navPoint>"}else for(var o in i=0,e)i++,a=e[o],n=n+'<navPoint class="chapter"'+ft.attr("playOrder",o+1,!1,!1)+ft.attr("id",a.id,!1,!1)+"><navLabel><text>"+ft.escape(null==(t=a.title)?"":t)+"</text></navLabel><content"+ft.attr("src",a.id+".xhtml",!1,!1)+"></content></navPoint>"}).call(this),n+="</navMap></ncx>"}.call(this,"authors"in r?r.authors:"undefined"!=typeof authors?authors:void 0,"chapters"in r?r.chapters:"undefined"!=typeof chapters?chapters:void 0,"programName"in r?r.programName:"undefined"!=typeof programName?programName:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0,"uuid"in r?r.uuid:"undefined"!=typeof uuid?uuid:void 0),n}function gt(e){var t,n="",r=e||{};return function(e,r){n=n+'<?xml version="1.0" encoding="utf-8" ?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"><head><title>'+ft.escape(null==(t=r)?"":t)+'</title><meta charset="utf-8"></meta></head><body><section epub:type="frontmatter toc"><header><h1>Содержание</h1></header><nav id="toc" epub:type="toc">               <ol>',(()=>{var r=e;if("number"==typeof r.length)for(var o=0,i=r.length;o<i;o++){var a=r[o];n=n+"<li"+ft.attr("id",a.id,!1,!1)+"><a"+ft.attr("href",a.id+".xhtml",!1,!1)+">"+ft.escape(null==(t=a.title)?"":t)+"</a></li>"}else for(var o in i=0,r)i++,a=r[o],n=n+"<li"+ft.attr("id",a.id,!1,!1)+"><a"+ft.attr("href",a.id+".xhtml",!1,!1)+">"+ft.escape(null==(t=a.title)?"":t)+"</a></li>"}).call(this),n+="</ol></nav></section></body></html>"}.call(this,"chapters"in r?r.chapters:"undefined"!=typeof chapters?chapters:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}function yt(e){var t,n="",r=e||{};return function(e,r,o,i,a,s,l,c,u){n=n+'<?xml version="1.0" encoding="utf-8" ?><package version="3.0" unique-identifier="BookId" xmlns="http://www.idpf.org/2007/opf"><metadata xmlns:dc="http://purl.org/dc/elements/1.1/"><dc:identifier id="BookId">'+(null==(t=u)?"":t)+'</dc:identifier><dc:title id="main">'+ft.escape(null==(t=c)?"":t)+'</dc:title><meta refines="#main" property="title-type">main</meta>',l&&(n=n+'<dc:title id="subtitle">'+ft.escape(null==(t=l)?"":t)+'</dc:title><meta refines="#subtitle" property="title-type">subtitle</meta>'),n+="<dc:language>ru</dc:language>",e&&(n=n+"<dc:description>"+ft.escape(null==(t=e)?"":t)+"</dc:description>"),(()=>{var e=r;if("number"==typeof e.length)for(var o=0,i=e.length;o<i;o++){var a=e[o];n=0===o?n+'<dc:creator id="author">'+ft.escape(null==(t=a.name)?"":t)+'</dc:creator><meta refines="#author" property="role" scheme="marc:relators">aut</meta>':n+"<dc:creator>"+ft.escape(null==(t=a.name)?"":t)+"</dc:creator>"}else for(var o in i=0,e)i++,a=e[o],n=0===o?n+'<dc:creator id="author">'+ft.escape(null==(t=a.name)?"":t)+'</dc:creator><meta refines="#author" property="role" scheme="marc:relators">aut</meta>':n+"<dc:creator>"+ft.escape(null==(t=a.name)?"":t)+"</dc:creator>"}).call(this),i&&(n+='<meta name="cover" content="CoverImage"></meta>'),n=n+"<dc:date>"+(null==(t=s)?"":t)+'</dc:date><meta property="dcterms:modified">'+(null==(t=s)?"":t)+"</meta></metadata><manifest>",i&&(n=n+'<item id="CoverImage"'+ft.attr("href","images/"+i.id+i.ext,!1,!1)+ft.attr("media-type",i.mime,!1,!1)+' properties="cover-image"></item>'),(()=>{var e=a;if("number"==typeof e.length)for(var t=0,r=e.length;t<r;t++){var o=e[t];i!=o&&(n=n+"<item"+(ft.attr("id",o.id,!1,!1)+ft.attr("media-type",o.mime,!1,!1)+ft.attr("href","images/"+o.id+o.ext,!1,!1))+"></item>")}else for(var t in r=0,e)r++,o=e[t],i!=o&&(n=n+"<item"+(ft.attr("id",o.id,!1,!1)+ft.attr("media-type",o.mime,!1,!1)+ft.attr("href","images/"+o.id+o.ext,!1,!1))+"></item>")}).call(this),n+='<item id="ncx" href="toc.ncx" media-type="application/x-dtbncx+xml"></item><item id="nav" href="nav.xhtml" media-type="application/xhtml+xml" properties="nav"></item>',(()=>{var e=o;if("number"==typeof e.length)for(var t=0,r=e.length;t<r;t++){var i=e[t];n=n+"<item"+(ft.attr("id",i.id,!1,!1)+ft.attr("href",i.id+".xhtml",!1,!1))+' media-type="application/xhtml+xml"></item>'}else for(var t in r=0,e)r++,i=e[t],n=n+"<item"+(ft.attr("id",i.id,!1,!1)+ft.attr("href",i.id+".xhtml",!1,!1))+' media-type="application/xhtml+xml"></item>'}).call(this),n+='</manifest><spine toc="ncx"><itemref idref="nav"></itemref>',(()=>{var e=o;if("number"==typeof e.length)for(var t=0,r=e.length;t<r;t++){var i=e[t];n=n+"<itemref"+ft.attr("idref",i.id,!1,!1)+"></itemref>"}else for(var t in r=0,e)r++,i=e[t],n=n+"<itemref"+ft.attr("idref",i.id,!1,!1)+"></itemref>"}).call(this),n+="</spine></package>"}.call(this,"annotation"in r?r.annotation:"undefined"!=typeof annotation?annotation:void 0,"authors"in r?r.authors:"undefined"!=typeof authors?authors:void 0,"chapters"in r?r.chapters:"undefined"!=typeof chapters?chapters:void 0,"cover"in r?r.cover:"undefined"!=typeof cover?cover:void 0,"images"in r?r.images:"undefined"!=typeof images?images:void 0,"isoDate"in r?r.isoDate:"undefined"!=typeof isoDate?isoDate:void 0,"subtitle"in r?r.subtitle:"undefined"!=typeof subtitle?subtitle:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0,"uuid"in r?r.uuid:"undefined"!=typeof uuid?uuid:void 0),n}var bt="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function vt(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on".concat(t),(()=>{n(window.event)}))}function wt(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function xt(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}for(var $t={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":bt?173:189,"=":bt?61:187,";":bt?59:186,"'":222,"[":219,"]":221,"\\":220},kt={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},_t={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},St={16:!1,18:!1,17:!1,91:!1},At={},Et=1;Et<20;Et++)$t["f".concat(Et)]=111+Et;var Mt=[],Ot=!1,Ct="all",Tt=[],Dt=e=>$t[e.toLowerCase()]||kt[e.toLowerCase()]||e.toUpperCase().charCodeAt(0);function Lt(e){Ct=e||"all"}function jt(){return Ct||"all"}var Pt=e=>{var t=e.key,n=e.scope,r=e.method,o=e.splitKey,i=void 0===o?"+":o;xt(t).forEach((e=>{var t=e.split(i),o=t.length,a=t[o-1],s="*"===a?"*":Dt(a);if(At[s]){n||(n=jt());var l=o>1?wt(kt,t):[];At[s]=At[s].filter((e=>!((!r||e.method===r)&&e.scope===n&&((e,t)=>{for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,o=!0,i=0;i<n.length;i++)-1===r.indexOf(n[i])&&(o=!1);return o})(e.mods,l))))}}))};function qt(e,t,n,r){var o;if(t.element===r&&(t.scope===n||"all"===t.scope)){for(var i in o=t.mods.length>0,St)Object.prototype.hasOwnProperty.call(St,i)&&(!St[i]&&t.mods.indexOf(+i)>-1||St[i]&&-1===t.mods.indexOf(+i))&&(o=!1);(0!==t.mods.length||St[16]||St[18]||St[17]||St[91])&&!o&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function Bt(e,t){var n=At["*"],r=e.keyCode||e.which||e.charCode;if(Nt.filter.call(this,e)){if(93!==r&&224!==r||(r=91),-1===Mt.indexOf(r)&&229!==r&&Mt.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach((t=>{var n=_t[t];e[t]&&-1===Mt.indexOf(n)?Mt.push(n):!e[t]&&Mt.indexOf(n)>-1?Mt.splice(Mt.indexOf(n),1):"metaKey"===t&&e[t]&&3===Mt.length&&(e.ctrlKey||e.shiftKey||e.altKey||(Mt=Mt.slice(Mt.indexOf(n))))})),r in St){for(var o in St[r]=!0,kt)kt[o]===r&&(Nt[o]=!0);if(!n)return}for(var i in St)Object.prototype.hasOwnProperty.call(St,i)&&(St[i]=e[_t[i]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===Mt.indexOf(17)&&Mt.push(17),-1===Mt.indexOf(18)&&Mt.push(18),St[17]=!0,St[18]=!0);var a=jt();if(n)for(var s=0;s<n.length;s++)n[s].scope===a&&("keydown"===e.type&&n[s].keydown||"keyup"===e.type&&n[s].keyup)&&qt(e,n[s],a,t);if(r in At)for(var l=0;l<At[r].length;l++)if(("keydown"===e.type&&At[r][l].keydown||"keyup"===e.type&&At[r][l].keyup)&&At[r][l].key){for(var c=At[r][l],u=c.splitKey,d=c.key.split(u),f=[],p=0;p<d.length;p++)f.push(Dt(d[p]));f.sort().join("")===Mt.sort().join("")&&qt(e,c,a,t)}}}function Nt(e,t,n){Mt=[];var r=xt(e),o=[],i="all",a=document,s=0,l=!1,c=!0,u="+";for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(i=t.scope),t.element&&(a=t.element),t.keyup&&(l=t.keyup),void 0!==t.keydown&&(c=t.keydown),"string"==typeof t.splitKey&&(u=t.splitKey)),"string"==typeof t&&(i=t);s<r.length;s++)o=[],(e=r[s].split(u)).length>1&&(o=wt(kt,e)),(e="*"===(e=e[e.length-1])?"*":Dt(e))in At||(At[e]=[]),At[e].push({keyup:l,keydown:c,scope:i,mods:o,shortcut:r[s],method:n,key:r[s],splitKey:u,element:a});void 0!==a&&!(e=>Tt.indexOf(e)>-1)(a)&&window&&(Tt.push(a),vt(a,"keydown",(e=>{Bt(e,a)})),Ot||(Ot=!0,vt(window,"focus",(()=>{Mt=[]}))),vt(a,"keyup",(e=>{Bt(e,a),(e=>{var t=e.keyCode||e.which||e.charCode,n=Mt.indexOf(t);if(n>=0&&Mt.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&Mt.splice(0,Mt.length),93!==t&&224!==t||(t=91),t in St)for(var r in St[t]=!1,kt)kt[r]===t&&(Nt[r]=!1)})(e)})))}var Ut={setScope:Lt,getScope:jt,deleteScope:(e,t)=>{var n,r;for(var o in e||(e=jt()),At)if(Object.prototype.hasOwnProperty.call(At,o))for(n=At[o],r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++;jt()===e&&Lt(t||"all")},getPressedKeyCodes:()=>Mt.slice(0),isPressed:e=>("string"==typeof e&&(e=Dt(e)),-1!==Mt.indexOf(e)),filter:e=>{var t=e.target||e.srcElement,n=t.tagName,r=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(r=!1),r},trigger:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(At).forEach((n=>{var r=At[n].find((n=>n.scope===t&&n.shortcut===e));r&&r.method&&r.method()}))},unbind:function(e){if(e){if(Array.isArray(e))e.forEach((e=>{e.key&&Pt(e)}));else if("object"==typeof e)e.key&&Pt(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=n[0],i=n[1];"function"==typeof o&&(i=o,o=""),Pt({key:e,scope:o,method:i,splitKey:"+"})}}else Object.keys(At).forEach((e=>delete At[e]))},keyMap:$t,modifier:kt,modifierMap:_t};for(var It in Ut)Object.prototype.hasOwnProperty.call(Ut,It)&&(Nt[It]=Ut[It]);if("undefined"!=typeof window){var Rt=window.hotkeys;Nt.noConflict=e=>(e&&window.hotkeys===Nt&&(window.hotkeys=Rt),Nt),window.hotkeys=Nt}function Ht(e){let n,r;return{c:t,m(t,o){n||(r=u(Ft.call(null,window,e[0])),n=!0)},p:t,i:t,o:t,d(e){n=!1,r()}}}function Ft(e,t){return Nt("ctrl+s",(e=>{e.stopImmediatePropagation(),e.preventDefault(),t()})),{destroy(){Nt.unbind("ctrl+s")}}}function Kt(e){const t=U();return[()=>{t("save")}]}class zt extends pe{constructor(e){super(),fe(this,e,Kt,Ht,s,{})}}function Yt(e){y(e,"svelte-2dsdd9",'.u_b{position:fixed;z-index:16777270;right:0;bottom:0;background:hsla(0,0%,100%,.8);width:100vw;height:100vh;-webkit-user-select:none;user-select:none;display:flex;flex-direction:column;align-items:center;justify-content:center}.u_cancel{margin-top:5%;border:0;background-color:var(--uc);color:#fff;padding:0 2em;line-height:2.7em;border-radius:3px;cursor:pointer;box-shadow:0 0 0 6px var(--uct);transition:box-shadow .1s;font-family:Ubuntu,Segoe UI,Optima,Trebuchet MS,-apple-system,BlinkMacSystemFont,sans-serif!important;font-size:16px}@media screen and (min-width:240px){.u_cancel{font-size:calc(13.33333px + 1.11111vw)}}@media screen and (min-width:960px){.u_cancel{font-size:24px}}.u_cancel:active,.u_cancel:focus,.u_cancel:hover{outline:0;box-shadow:0 0 0 6px var(--uch)}.u_c{position:relative;pointer-events:none;width:100px;height:100px;line-height:100px;text-align:center;color:var(--uc);font-family:Ubuntu,Segoe UI,Optima,Trebuchet MS,-apple-system,BlinkMacSystemFont,sans-serif!important;font-size:14px}@media screen and (min-width:240px){.u_c{font-size:calc(11.66667px + .97222vw)}}@media screen and (min-width:960px){.u_c{font-size:21px}}.u_c>*{width:100%;height:100%;position:absolute}.u_c>:before{content:"";display:block;margin:0 auto;width:15%;height:15%;background-color:var(--uc);border-radius:100%;animation:u_a 1.2s ease-in-out infinite both}.u_c2{transform:rotate(30deg)}.u_c2:before{animation-delay:-1.1s}.u_c3{transform:rotate(60deg)}.u_c3:before{animation-delay:-1s}.u_c4{transform:rotate(90deg)}.u_c4:before{animation-delay:-.9s}.u_c5{transform:rotate(120deg)}.u_c5:before{animation-delay:-.8s}.u_c6{transform:rotate(150deg)}.u_c6:before{animation-delay:-.7s}.u_c7{transform:rotate(180deg)}.u_c7:before{animation-delay:-.6s}.u_c8{transform:rotate(210deg)}.u_c8:before{animation-delay:-.5s}.u_c9{transform:rotate(240deg)}.u_c9:before{animation-delay:-.4s}.u_c10{transform:rotate(270deg)}.u_c10:before{animation-delay:-.3s}.u_c11{transform:rotate(300deg)}.u_c11:before{animation-delay:-.2s}.u_c12{transform:rotate(330deg)}.u_c12:before{animation-delay:-.1s}@keyframes u_a{0%,80%,to{transform:scale(0)}40%{transform:scale(1)}}')}function Wt(e){let n,r,o,i,a,s,l,c,u,d,f,p,h,m,y,b,v,w,_,O,T,D,L,j,P,q,B,N,U,I,R,H=e[1]+"%";return{c(){n=k("div"),r=k("div"),o=k("div"),i=S(),a=k("div"),s=S(),l=k("div"),c=S(),u=k("div"),d=S(),f=k("div"),p=S(),h=k("div"),m=S(),y=k("div"),b=S(),v=k("div"),w=S(),_=k("div"),O=S(),T=k("div"),D=S(),L=k("div"),j=S(),P=k("div"),q=S(),B=new C,N=S(),U=k("button"),U.textContent="Cancel",E(o,"class","u_c1"),E(a,"class","u_c2"),E(l,"class","u_c3"),E(u,"class","u_c4"),E(f,"class","u_c5"),E(h,"class","u_c6"),E(y,"class","u_c7"),E(v,"class","u_c8"),E(_,"class","u_c9"),E(T,"class","u_c10"),E(L,"class","u_c11"),E(P,"class","u_c12"),B.a=null,E(r,"class","u_c"),E(U,"class","u_cancel"),E(n,"class","u_b"),M(n,"--uc",e[0](1)),M(n,"--uch",e[0](.5)),M(n,"--uct",e[0](0))},m(t,$){x(t,n,$),g(n,r),g(r,o),g(r,i),g(r,a),g(r,s),g(r,l),g(r,c),g(r,u),g(r,d),g(r,f),g(r,p),g(r,h),g(r,m),g(r,y),g(r,b),g(r,v),g(r,w),g(r,_),g(r,O),g(r,T),g(r,D),g(r,L),g(r,j),g(r,P),g(r,q),B.m(H,r),g(n,N),g(n,U),I||(R=A(U,"click",e[2]),I=!0)},p(e,[t]){2&t&&H!==(H=e[1]+"%")&&B.p(H),1&t&&M(n,"--uc",e[0](1)),1&t&&M(n,"--uch",e[0](.5)),1&t&&M(n,"--uct",e[0](0))},i:t,o:t,d(e){e&&$(n),I=!1,R()}}}function Gt(e,t,n){let r;l(e,Le,(e=>n(1,r=e)));let{color:o=(()=>"red")}=t;const i=U();return e.$$set=e=>{"color"in e&&n(0,o=e.color)},[o,r,()=>{i("cancel")}]}class Jt extends pe{constructor(e){super(),fe(this,e,Gt,Wt,s,{color:0},Yt)}}function Xt(e){let t,n;const r=e[2].default,o=((e,t,n,r)=>{if(e){const r=c(e,t,n,null);return e[0](r)}})(r,e,e[1]);return{c(){t=k("menu"),o&&o.c(),E(t,"type","context"),E(t,"id",e[0])},m(e,r){x(e,t,r),o&&o.m(t,null),n=!0},p(e,[t]){var i,a;o&&o.p&&(!n||2&t)&&((e,t,n,r,o,i)=>{if(o){const i=c(t,n,r,null);e.p(i,o)}})(o,r,e,e[1],n?(i=r,a=e[1],i[2],a.dirty):(e=>{if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1})(e[1]))},i(e){n||(oe(o,e),n=!0)},o(e){ie(o,e),n=!1},d(e){e&&$(t),o&&o.d(e)}}}function Zt(e,t,n){let{$$slots:r={},$$scope:o}=t;const i="_menu_ranobe-ebook-loader_"+Math.random().toString(16).replace(".","");return B((()=>document.body.setAttribute("contextmenu",i))),N((()=>document.body.removeAttribute("contextmenu"))),e.$$set=e=>{"$$scope"in e&&n(1,o=e.$$scope)},[i,o,r]}class Vt extends pe{constructor(e){super(),fe(this,e,Zt,Xt,s,{})}}function Qt(e){let n,r,o,s;return{c(){n=k("menuitem"),E(n,"label",e[0]),E(n,"icon",e[1])},m(t,i){x(t,n,i),o||(s=[A(n,"click",e[2]),u(r=e[3].call(null,n,e[0]))],o=!0)},p(e,[t]){1&t&&E(n,"label",e[0]),2&t&&E(n,"icon",e[1]),r&&a(r.update)&&1&t&&r.update.call(null,e[0])},i:t,o:t,d(e){e&&$(n),o=!1,i(s)}}}function en(e,t,n){let{label:r="ranobe-ebook-loader"}=t,{icon:o="https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/icons/32.png"}=t;const i=U();function a(){i("trigger")}return e.$$set=e=>{"label"in e&&n(0,r=e.label),"icon"in e&&n(1,o=e.icon)},[r,o,a,(e,t)=>{let n="undefined"!=typeof GM_registerMenuCommand&&GM_registerMenuCommand(t,a);function r(){n&&GM_unregisterMenuCommand(n)}return{destroy:r,update(e){r(),n="undefined"!=typeof GM_registerMenuCommand&&GM_registerMenuCommand(e,a)}}}]}class tn extends pe{constructor(e){super(),fe(this,e,en,Qt,s,{label:0,icon:1})}}function nn(e){const t=e-1;return t*t*t+1}function rn(e,{delay:t=0,duration:n=400,easing:r=nn}={}){const o=getComputedStyle(e),i=+o.opacity,a=parseFloat(o.height),s=parseFloat(o.paddingTop),l=parseFloat(o.paddingBottom),c=parseFloat(o.marginTop),u=parseFloat(o.marginBottom),d=parseFloat(o.borderTopWidth),f=parseFloat(o.borderBottomWidth);return{delay:t,duration:n,easing:r,css:e=>`overflow: hidden;opacity: ${Math.min(20*e,1)*i};height: ${e*a}px;padding-top: ${e*s}px;padding-bottom: ${e*l}px;margin-top: ${e*c}px;margin-bottom: ${e*u}px;border-top-width: ${e*d}px;border-bottom-width: ${e*f}px;`}}function on(e){y(e,"svelte-v02y3s",".u_d{position:fixed;z-index:16777270;right:0;bottom:0;bottom:3px;right:3px;display:flex;flex-direction:column;align-items:flex-end;color:#fff;pointer-events:none}.u_bb,.u_n{margin:3px;display:flex;pointer-events:auto;transform:translateZ(0);-webkit-backface-visibility:hidden;backface-visibility:hidden}.u_m{flex-grow:1;padding:6px 9px;border-top-left-radius:3px;border-bottom-left-radius:3px;white-space:pre-wrap;word-wrap:break-word;max-width:calc(100vw - 70px);font-family:Ubuntu,Segoe UI,Optima,Trebuchet MS,-apple-system,BlinkMacSystemFont,sans-serif!important;font-size:14px}.u_m,.u_r{background-color:rgba(213,0,0,.85)}.u_r{display:flex;flex-direction:column;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:1px}.u_b,.u_bb,.u_bf,.u_bl{background-color:transparent;padding:6px;border:0;-webkit-user-select:none;user-select:none;color:#fff;text-align:center;cursor:pointer;font-family:Ubuntu,Segoe UI,Optima,Trebuchet MS,-apple-system,BlinkMacSystemFont,sans-serif!important;font-size:14px}.u_bf{padding-bottom:0}.u_bl{padding-top:0}.u_bb{background-color:rgba(213,0,0,.85);border-radius:3px}@keyframes u_shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}")}function an(e,t,n){const r=e.slice();return r[3]=t[n],r}function sn(e,t){let n,r,o,a,s,l,c,u,d,f,p,h,m=t[3]+"";function y(){return t[1](t[3])}function b(...e){return t[2](t[3],...e)}return{key:e,first:null,c(){n=k("div"),r=k("div"),o=_(m),a=S(),s=k("div"),l=k("button"),l.textContent="🞩",c=S(),u=k("button"),u.textContent="⎀",E(r,"class","u_m"),E(l,"class","u_bf"),E(u,"class","u_bl"),E(u,"title","Click to copy"),E(s,"class","u_r"),E(n,"class","u_n"),this.first=n},m(e,t){x(e,n,t),g(n,r),g(r,o),g(n,a),g(n,s),g(s,l),g(s,c),g(s,u),f=!0,p||(h=[A(l,"click",y),A(u,"click",b)],p=!0)},p(e,n){t=e,(!f||1&n)&&m!==(m=t[3]+"")&&((e,t)=>{t=""+t,e.wholeText!==t&&(e.data=t)})(o,m)},i(e){f||(e&&W((()=>{d||(d=se(n,rn,{},!0)),d.run(1)})),f=!0)},o(e){e&&(d||(d=se(n,rn,{},!1)),d.run(0)),f=!1},d(e){e&&$(n),e&&d&&d.end(),p=!1,i(h)}}}function ln(e){let n,r,o,i,a;return{c(){n=k("button"),n.textContent="Close all",E(n,"class","u_bb")},m(e,t){x(e,n,t),o=!0,i||(a=A(n,"click",De.clear),i=!0)},p:t,i(e){o||(e&&W((()=>{r||(r=se(n,rn,{},!0)),r.run(1)})),o=!0)},o(e){e&&(r||(r=se(n,rn,{},!1)),r.run(0)),o=!1},d(e){e&&$(n),e&&r&&r.end(),i=!1,a()}}}function cn(e){let t,n,r,o=[],i=new Map,a=Array.from(e[0]);const s=e=>e[3];for(let t=0;t<a.length;t+=1){let n=an(e,a,t),r=s(n);i.set(r,o[t]=sn(r,n))}let l=e[0].size>2&&ln();return{c(){t=k("div");for(let e=0;e<o.length;e+=1)o[e].c();n=S(),l&&l.c(),E(t,"class","u_d")},m(e,i){x(e,t,i);for(let e=0;e<o.length;e+=1)o[e].m(t,null);g(t,n),l&&l.m(t,null),r=!0},p(e,[r]){1&r&&(a=Array.from(e[0]),ne(),o=((e,t,n,r,o,i,a,s,l,c,u,d)=>{let f=e.length,p=i.length,h=f;const m={};for(;h--;)m[e[h].key]=h;const g=[],y=new Map,b=new Map;for(h=p;h--;){const e=d(o,i,h),r=n(e);let s=a.get(r);s?s.p(e,t):(s=c(r,e),s.c()),y.set(r,g[h]=s),r in m&&b.set(r,Math.abs(h-m[r]))}const v=new Set,w=new Set;function x(e){oe(e,1),e.m(s,u),a.set(e.key,e),u=e.first,p--}for(;f&&p;){const t=g[p-1],n=e[f-1],r=t.key,o=n.key;t===n?(u=t.first,f--,p--):y.has(o)?!a.has(r)||v.has(r)?x(t):w.has(o)?f--:b.get(r)>b.get(o)?(w.add(r),x(t)):(v.add(o),f--):(l(n,a),f--)}for(;f--;){const t=e[f];y.has(t.key)||l(t,a)}for(;p;)x(g[p-1]);return g})(o,r,s,0,e,a,i,t,le,sn,n,an),re()),e[0].size>2?l?(l.p(e,r),1&r&&oe(l,1)):(l=ln(),l.c(),oe(l,1),l.m(t,null)):l&&(ne(),ie(l,1,1,(()=>{l=null})),re())},i(e){if(!r){for(let e=0;e<a.length;e+=1)oe(o[e]);oe(l),r=!0}},o(e){for(let e=0;e<o.length;e+=1)ie(o[e]);ie(l),r=!1},d(e){e&&$(t);for(let e=0;e<o.length;e+=1)o[e].d();l&&l.d()}}}function un(e,t,n){let r;return l(e,De,(e=>n(0,r=e))),[r,e=>De.remove(e),(e,t)=>((e,t)=>{navigator.clipboard.writeText(e).then((()=>{const e=t.target.closest(".u_n");e.style.animation=null,e.getBoundingClientRect(),e.style.animation="u_shake 0.6s cubic-bezier(0.36, 0.07, 0.19, 0.97)"})).catch(De.add)})(e,t)]}class dn extends pe{constructor(e){super(),fe(this,e,un,cn,s,{},on)}}var fn=me(((e,t)=>{(()=>{function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=()=>{a(r.response,t,n)},r.onerror=()=>{console.error("could not download file")},r.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof he&&he.global===he?he:void 0,i=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=o.saveAs||("object"!=typeof window||window!==o?()=>{}:"download"in HTMLAnchorElement.prototype&&!i?(e,i,a)=>{var s=o.URL||o.webkitURL,l=document.createElement("a");i=i||e.name||"download",l.download=i,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):n(l.href)?t(e,i,a):r(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((()=>{s.revokeObjectURL(l.href)}),4e4),setTimeout((()=>{r(l)}),0))}:"msSaveOrOpenBlob"in navigator?(e,o,i)=>{if(o=o||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,i),o);else if(n(e))t(e,o,i);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout((()=>{r(a)}))}}:(e,n,r,a)=>{if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var s="application/octet-stream"===e.type,l=/constructor/i.test(o.HTMLElement)||o.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||i)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=()=>{var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},u.readAsDataURL(e)}else{var d=o.URL||o.webkitURL,f=d.createObjectURL(e);a?a.location=f:location.href=f,a=null,setTimeout((()=>{d.revokeObjectURL(f)}),4e4)}});o.saveAs=a.saveAs=a,e.exports=a})()}));const pn={once:!0};function hn(...e){const t=(()=>{let e,t;return{promise:new Promise(((n,r)=>{t=n,e=r})),resolve:t,reject:e}})();function n(){for(const[t,...r]of e)for(const e of r)t.removeEventListener(e,n);t.resolve(void 0)}for(const[t,...r]of e)for(const e of r)t.addEventListener(e,n,pn);return t}const mn=new Uint8Array(16);async function gn(e,t){const n=new Uint8Array(t.byteLength+e.length);n.set(t,0),n.set(e,t.byteLength);const r=new Uint8Array(await crypto.subtle.digest("SHA-1",n)),o=new Uint8Array(16);return o.set(r.subarray(0,4),0),o.set(r.subarray(4,10),4),o.set(r.subarray(6,14),6),o[6]=15&o[6]|80,o[8]=63&r[8]|128,o[9]=r[9],o.set(r.subarray(10,16),10),o}let yn=null;async function bn(e){return yn||(yn=await gn(Oe.encode("ranobe-ebook-loader"),mn)),(e=>{let t="";for(let n=0;n<16;++n)t+=e[n].toString(16).padStart(2,"0");return[(n=t).slice(0,8),n.slice(8,12),n.slice(12,16),n.slice(16,20),n.slice(20)].join("-");var n})(await gn(Oe.encode(e),yn))}const vn=[];for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;vn[e]=t}function wn(e){let t=-1;for(const n of e)t=t>>>8^vn[255&(t^n)];return-1^t}function xn(e,t){const n=[];for(;t--;)n.push(255&e),e>>>=8;return n}function $n(e){y(e,"svelte-jnedj2","#ranobe-ebook-loader{position:fixed;z-index:16777270;right:0;bottom:0}")}function kn(e){let t,n,r,o,s,l,c,d,f,p,h,m,y,b;return t=new zt({}),t.$on("save",e[5]),r=new Vt({props:{$$slots:{default:[Sn]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment),n=S(),ce(r.$$.fragment),o=S(),s=k("button"),l=_(En),d=S(),f=k("button"),p=_(Mn),E(s,"class",e[2].component),E(f,"class",e[2].component)},m(i,a){ue(t,i,a),x(i,n,a),ue(r,i,a),x(i,o,a),x(i,s,a),g(s,l),x(i,d,a),x(i,f,a),g(f,p),m=!0,y||(b=[A(s,"click",e[4]),u(c=tt.call(null,s,e[1])),A(f,"click",e[5]),u(h=tt.call(null,f,e[1]))],y=!0)},p(e,t){const n={};512&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n),c&&a(c.update)&&2&t&&c.update.call(null,e[1]),h&&a(h.update)&&2&t&&h.update.call(null,e[1])},i(e){m||(oe(t.$$.fragment,e),oe(r.$$.fragment,e),m=!0)},o(e){ie(t.$$.fragment,e),ie(r.$$.fragment,e),m=!1},d(e){de(t,e),e&&$(n),de(r,e),e&&$(o),e&&$(s),e&&$(d),e&&$(f),y=!1,i(b)}}}function _n(e){let n,r;return n=new Jt({props:{color:e[2].color}}),n.$on("cancel",e[3]),{c(){ce(n.$$.fragment)},m(e,t){ue(n,e,t),r=!0},p:t,i(e){r||(oe(n.$$.fragment,e),r=!0)},o(e){ie(n.$$.fragment,e),r=!1},d(e){de(n,e)}}}function Sn(e){let n,r,o,i;return n=new tn({props:{label:En}}),n.$on("trigger",e[4]),o=new tn({props:{label:Mn}}),o.$on("trigger",e[5]),{c(){ce(n.$$.fragment),r=S(),ce(o.$$.fragment)},m(e,t){ue(n,e,t),x(e,r,t),ue(o,e,t),i=!0},p:t,i(e){i||(oe(n.$$.fragment,e),oe(o.$$.fragment,e),i=!0)},o(e){ie(n.$$.fragment,e),ie(o.$$.fragment,e),i=!1},d(e){de(n,e),e&&$(r),de(o,e)}}}function An(e){let t,n,r,o,i;const a=[_n,kn],s=[];function l(e,t){return e[0]?0:e[1]?1:-1}return~(t=l(e))&&(n=s[t]=a[t](e)),o=new dn({}),{c(){n&&n.c(),r=S(),ce(o.$$.fragment)},m(e,n){~t&&s[t].m(e,n),x(e,r,n),ue(o,e,n),i=!0},p(e,[o]){let i=t;t=l(e),t===i?~t&&s[t].p(e,o):(n&&(ne(),ie(s[i],1,1,(()=>{s[i]=null})),re()),~t?(n=s[t],n?n.p(e,o):(n=s[t]=a[t](e),n.c()),oe(n,1),n.m(r.parentNode,r)):n=null)},i(e){i||(oe(n),oe(o.$$.fragment,e),i=!0)},o(e){ie(n),ie(o.$$.fragment,e),i=!1},d(e){~t&&s[t].d(e),e&&$(r),de(o,e)}}}const En="Скачать *.fb2",Mn="Скачать *.epub";function On(e,t,n){const r={"ранобэ.рф":st,"xn--80ac9aeh6f.xn--p1ai":st,"ranobes.com":lt,"tl.rulate.ru":ut,"jaomix.ru":dt}[location.hostname];let o,i=!1,a=null;function s(){o&&(o.abort(),o=null),i&&n(0,i=!1),Le.clear()}const l=new AbortController;B((async()=>{if(r.spa){history.pushState=Ne("pushState"),history.replaceState=Ne("replaceState");const e=e=>setTimeout(e,2e3);for(;!l.signal.aborted;){for(;!n(1,a=r.injectTarget);)if(await new Promise(e),l.signal.aborted)return;await hn([l.signal,"abort"],[window,"pushState","replaceState","popstate"]).promise,s(),await new Promise(e)}}else n(1,a=await r.injectTarget)})),N((()=>{var e,t,n,o;l.abort(),s(),r.spa&&(null===(t=(e=history.pushState).destroy)||void 0===t||t.call(e),null===(o=(n=history.replaceState).destroy)||void 0===o||o.call(n))}));const c=d.bind(null,Xe),u=d.bind(null,Ze);async function d(e){if(!i&&a)try{s(),n(0,i=!0),o=new AbortController,De.clear(),await(Y(),K);const t=new Map,a=async e=>(e.id=await Ce(e.title),e.text=await Qe(function(e){var t,n="",r=e||{};return((e,r)=>{n=n+"<!DOCTYPE html><body><section><header><h1>"+ft.escape(null==(t=r)?"":t)+"</h1></header>"+(null==(t=e)?"":t)+"</section></body>"}).call(this,"text"in r?r.text:"undefined"!=typeof text?text:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}(e),o,Ze,1,t),e.text=function(e){var t,n="",r=e||{};return((e,r)=>{n=n+'<?xml version="1.0" encoding="utf-8" ?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"><head><title>'+ft.escape(null==(t=r)?"":t)+'</title><style lang="css">img{display:inline-block;width:auto;height:auto;max-width:100%;max-height:100%;page-break-before:avoid;page-break-after:auto;page-break-inside:avoid;}</style></head><body>'+(null==(t=e)?"":t)+"</body></html>"}).call(this,"text"in r?r.text:"undefined"!=typeof text?text:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}(e),e),l=new r,c=await l.parts(o,t,e===Ze?a:null);switch(e){case Ze:c.unshift(await a({title:"Аннотация",text:"<div>"+l.description+l.covers.map((e=>`<p><img src="${e}"/></p>`)).join("")+"</div>"}));const n=Array.from(nt(t)),r=Ye(c[0].text).querySelector("section");r.firstElementChild.remove();const i={...l,cover:t.get(l.covers[0]),isoDate:l.isoDate,uuid:"urn:uuid:"+await bn(l.title+l.subtitle+c.map((e=>e.title)).join("")),annotation:r.innerText.trim(),chapters:c,images:n};r.ownerDocument.open(),t.clear();const s="application/epub+zip";return fn.saveAs(new Blob(Array.from(function*(e){let t=0;const n=[];let r=0;for(const{path:o,data:i}of e){const e=i instanceof Uint8Array?i:Oe.encode(i),a=Oe.encode(o),s=[10,0,0,0,0,0,0,0,0,0,...xn(wn(e),4),...xn(e.length,4),...xn(e.length,4),...xn(a.length,2),0,0];n.push(80,75,1,2,20,0,...s,0,0,0,0,0,0,0,0,0,0,...xn(t,4),...a);const l=new Uint8Array([80,75,3,4,...s]);t+=l.byteLength+e.byteLength+a.byteLength,++r,yield l,yield a,yield e}n.push(80,75,5,6,0,0,0,0,...xn(r,2),...xn(r,2),...xn(n.length,4),...xn(t,4),0,0),yield new Uint8Array(n)}([{path:"mimetype",data:s},{path:"META-INF/container.xml",data:'<?xml version="1.0" encoding="utf-8" ?><container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container"><rootfiles><rootfile full-path="OEBPS/content.opf" media-type="application/oebps-package+xml"></rootfile></rootfiles></container>'},{path:"META-INF/com.apple.ibooks.display-options.xml",data:'<?xml version="1.0" encoding="utf-8" ?><display_options><platform name="*"><option name="specified-fonts">true</option><option name="interactive">false</option></platform></display_options>'},{path:"OEBPS/toc.ncx",data:mt(i)},{path:"OEBPS/nav.xhtml",data:gt(i)},{path:"OEBPS/content.opf",data:yt(i)},...n.map((e=>({path:"OEBPS/images/"+e.id+e.ext,data:e.data()}))),...c.map((e=>({path:`OEBPS/${e.id}.xhtml`,data:e.text})))])),{type:s}),l.bookAlias+".epub");case Xe:l.genres.length<1&&l.genres.push("unrecognised");const u=await(l.covers[0]&&ze("Обложка",l.covers[0],t,o));await(null==u?void 0:u.b64());const d=['<?xml version="1.0" encoding="utf-8"?><FictionBook xmlns="http://www.gribuser.ru/xml/fictionbook/2.0" xmlns:l="http://www.w3.org/1999/xlink">',pt({...l,cover:u,annotation:await Qe("<div>"+l.description+"</div>",o,e,5),shortDate:l.date("YYYY-MM-DD"),fullDate:l.date("DD.MM.YYYY")}),"<body>",await Qe(ht({title:l.title,chapters:c}),o,e,5,t),"</body>"];for(const e of nt(t))d.push(`<binary id="${u&&u.id==e.id?"cover":e.id}" content-type="${e.mime}">`,await e.b64(),"</binary>");return t.clear(),d.push("</FictionBook>"),fn.saveAs(new Blob(d,{type:"application/x-fictionbook+xml;charset=utf-8"}),l.bookAlias+".fb2")}}catch(e){"AbortError"!=(null==e?void 0:e.name)&&(console.error(e),De.add(e))}finally{s()}}return console.log("ranobe-ebook-loader 0.2.8"),[i,a,r,s,c,u]}const Cn={__proto__:null,default:class extends pe{constructor(e){super(),fe(this,e,On,An,s,{},$n)}}};
