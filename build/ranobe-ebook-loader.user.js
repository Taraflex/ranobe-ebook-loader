// ==UserScript==
// @name         ranobe-ebook-loader
// @namespace    mailto:taraflex.red@gmail.com
// @version      0.2.5
// @author       Taraflex <taraflex.red@gmail.com>
// @description  Юзерскрипт для скачивания книг (fb2, epub) c https://ранобэ.рф/ , https://ranobes.com/ , https://tl.rulate.ru/ , https://jaomix.ru/
// @license      MIT
// @homepageURL  https://github.com/Taraflex/ranobe-ebook-loader
// @icon         https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/icons/32.png
// @icon64       https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/icons/64.png
// @downloadURL  https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/build/ranobe-ebook-loader.user.js
// @updateURL    https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/build/ranobe-ebook-loader.meta.js
// @supportURL   https://github.com/Taraflex/ranobe-ebook-loader/issues
// @match        https://ранобэ.рф/*
// @match        https://xn--80ac9aeh6f.xn--p1ai/*
// @match        https://ranobes.com/ranobe/*
// @match        https://tl.rulate.ru/book/*
// @match        https://jaomix.ru/*
// @connect      *
// @run-at       document-idle
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        GM.xmlHttpRequest
// @noframes     
// ==/UserScript==
const e=()=>{document.removeEventListener("DOMContentLoaded",e);const t=document.createElement("div");t.id="ranobe-ebook-loader",document.body.appendChild(t),Promise.resolve().then((()=>wn)).then((e=>new e.default({target:t})))};function t(){}"complete"===document.readyState||"interactive"===document.readyState?e():document.addEventListener("DOMContentLoaded",e);const n=e=>e;function r(e){return e()}function o(){return Object.create(null)}function i(e){e.forEach(r)}function a(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(e,n,r){e.$$.on_destroy.push(((e,...n)=>{if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r})(n,r))}function c(e,t,n,r){return e[1]&&r?((e,t)=>{for(const n in t)e[n]=t[n];return e})(n.ctx.slice(),e[1](r(t))):n.ctx}function u(e){return e&&a(e.destroy)?e.destroy:t}const d="undefined"!=typeof window;let f=d?()=>window.performance.now():()=>Date.now(),p=d?e=>requestAnimationFrame(e):t;const h=new Set;function m(e){h.forEach((t=>{t.c(e)||(h.delete(t),t.f())})),0!==h.size&&p(m)}function g(e,t){e.appendChild(t)}function y(e,t,n){e.insertBefore(t,n||null)}function b(e){e.parentNode.removeChild(e)}function v(e){return document.createElement(e)}function w(e){return document.createTextNode(e)}function x(){return w(" ")}function $(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function k(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function _(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}function S(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}class A{constructor(e=null){this.a=e,this.e=this.n=null}m(e,t,n=null){this.e||(this.e=v(t.nodeName),this.t=t,this.h(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)y(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(b)}}const E=new Set;let M,O=0;function C(e,t,n,r,o,i,a,s=0){const l=16.666/r;let c="{\n";for(let e=0;e<=1;e+=l){const r=t+(n-t)*i(e);c+=100*e+`%{${a(r,1-r)}}\n`}const u=c+`100% {${a(n,1-n)}}\n}`,d=`__svelte_${(e=>{let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0})(u)}_${s}`,f=e.ownerDocument;E.add(f);const p=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(v("style")).sheet),h=f.__svelte_rules||(f.__svelte_rules={});h[d]||(h[d]=!0,p.insertRule(`@keyframes ${d} ${u}`,p.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?m+", ":""}${d} ${r}ms linear ${o}ms 1 both`,O+=1,d}function T(e){M=e}function D(){if(!M)throw new Error("Function called outside component initialization");return M}function j(e){D().$$.on_mount.push(e)}function L(e){D().$$.on_destroy.push(e)}function P(){const e=D();return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=S(t,n);r.slice().forEach((t=>{t.call(e,o)}))}}}const q=[],B=[],N=[],U=[],I=Promise.resolve();let H=!1;function R(){H||(H=!0,I.then(Y))}function F(e){N.push(e)}let K=!1;const z=new Set;function Y(){if(!K){K=!0;do{for(let e=0;e<q.length;e+=1){const t=q[e];T(t),W(t.$$)}for(T(null),q.length=0;B.length;)B.pop()();for(let e=0;e<N.length;e+=1){const t=N[e];z.has(t)||(z.add(t),t())}N.length=0}while(q.length);for(;U.length;)U.pop()();H=!1,K=!1,z.clear()}}function W(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(F)}}let G;function J(e,t,n){e.dispatchEvent(S(`${t?"intro":"outro"}${n}`))}const X=new Set;let Z;function V(){Z={r:0,c:[],p:Z}}function Q(){Z.r||i(Z.c),Z=Z.p}function ee(e,t){e&&e.i&&(X.delete(e),e.i(t))}function te(e,t,n,r){if(e&&e.o){if(X.has(e))return;X.add(e),Z.c.push((()=>{X.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}const ne={duration:0};function re(e,r,o,s){let l=r(e,o),c=s?0:1,u=null,d=null,g=null;function y(){g&&function(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),O-=o,O||p((()=>{O||(E.forEach((e=>{const t=e.__svelte_stylesheet;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.__svelte_rules={}})),E.clear())})))}(e,g)}function b(e,t){const n=e.b-c;return t*=Math.abs(n),{a:c,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function v(r){const{delay:o=0,duration:a=300,easing:s=n,tick:v=t,css:w}=l||ne,x={start:f()+o,b:r};r||(x.group=Z,Z.r+=1),u||d?d=x:(w&&(y(),g=C(e,c,r,a,o,s,w)),r&&v(0,1),u=b(x,a),F((()=>J(e,r,"start"))),(e=>{let t;0===h.size&&p(m),new Promise((n=>{h.add(t={c:e,f:n})}))})((t=>{if(d&&t>d.start&&(u=b(d,a),d=null,J(e,u.b,"start"),w&&(y(),g=C(e,c,u.b,u.duration,0,s,l.css))),u)if(t>=u.end)v(c=u.b,1-c),J(e,u.b,"end"),d||(u.b?y():--u.group.r||i(u.group.c)),u=null;else if(t>=u.start){const e=t-u.start;c=u.a+u.d*s(e/u.duration),v(c,1-c)}return!(!u&&!d)})))}return{run(e){a(l)?(G||(G=Promise.resolve(),G.then((()=>{G=null}))),G).then((()=>{l=l(),v(e)})):v(e)},end(){y(),u=d=null}}}function oe(e,t){te(e,1,1,(()=>{t.delete(e.key)}))}function ie(e){e&&e.c()}function ae(e,t,n){const{fragment:o,on_mount:s,on_destroy:l,after_update:c}=e.$$;o&&o.m(t,n),F((()=>{const t=s.map(r).filter(a);l?l.push(...t):i(t),e.$$.on_mount=[]})),c.forEach(F)}function se(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function le(e,n,r,a,s,l,c=[-1]){const u=M;T(e);const d=n.props||{},f=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:s,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:o(),dirty:c,skip_bound:!1};let p=!1;if(f.ctx=r?r(e,d,((t,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&s(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),p&&((e,t)=>{-1===e.$$.dirty[0]&&(q.push(e),R(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31})(e,t)),n})):[],f.update(),p=!0,i(f.before_update),f.fragment=!!a&&a(f.ctx),n.target){if(n.hydrate){const e=(e=>Array.from(e.childNodes))(n.target);f.fragment&&f.fragment.l(e),e.forEach(b)}else f.fragment&&f.fragment.c();n.intro&&ee(e.$$.fragment),ae(e,n.target,n.anchor),Y()}T(u)}class ce{$destroy(){se(this,1),this.$destroy=t}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var ue="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function de(e){var t={exports:{}};return e(t,t.exports),t.exports}var fe=de((function(e,t){e.exports=function(){var e="millisecond",t="second",n="minute",r="hour",o="day",i="week",a="month",s="quarter",l="year",c="date",u=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,d=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p=(e,t,n)=>{var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},h={s:p,z:e=>{var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),o=n%60;return(t<=0?"+":"-")+p(r,2,"0")+":"+p(o,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),o=t.clone().add(r,a),i=n-o<0,s=t.clone().add(r+(i?-1:1),a);return+(-(r+(n-o)/(i?o-s:s-o))||0)},a:e=>e<0?Math.ceil(e)||0:Math.floor(e),p:u=>({M:a,y:l,w:i,d:o,D:c,h:r,m:n,s:t,ms:e,Q:s}[u]||String(u||"").toLowerCase().replace(/s$/,"")),u:e=>void 0===e},m="en",g={};g[m]=f;var y=e=>e instanceof x,b=(e,t,n)=>{var r;if(!e)return m;if("string"==typeof e)g[e]&&(r=e),t&&(g[e]=t,r=e);else{var o=e.name;g[o]=e,r=o}return!n&&r&&(m=r),r||!n&&m},v=function(e,t){if(y(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new x(n)},w=h;w.l=b,w.i=y,w.w=(e,t)=>v(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset});var x=function(){function f(e){this.$L=b(e.locale,null,!0),this.parse(e)}var p=f.prototype;return p.parse=function(e){this.$d=(e=>{var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(w.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(u);if(r){var o=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],o,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],o,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(t)})(e),this.$x=e.x||{},this.init()},p.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},p.$utils=()=>w,p.isValid=function(){return!("Invalid Date"===this.$d.toString())},p.isSame=function(e,t){var n=v(e);return this.startOf(t)<=n&&n<=this.endOf(t)},p.isAfter=function(e,t){return v(e)<this.startOf(t)},p.isBefore=function(e,t){return this.endOf(t)<v(e)},p.$g=function(e,t,n){return w.u(e)?this[t]:this.set(n,e)},p.unix=function(){return Math.floor(this.valueOf()/1e3)},p.valueOf=function(){return this.$d.getTime()},p.startOf=function(e,s){var u=this,d=!!w.u(s)||s,f=w.p(e),p=(e,t)=>{var n=w.w(u.$u?Date.UTC(u.$y,t,e):new Date(u.$y,t,e),u);return d?n:n.endOf(o)},h=(e,t)=>w.w(u.toDate()[e].apply(u.toDate("s"),(d?[0,0,0,0]:[23,59,59,999]).slice(t)),u),m=this.$W,g=this.$M,y=this.$D,b="set"+(this.$u?"UTC":"");switch(f){case l:return d?p(1,0):p(31,11);case a:return d?p(1,g):p(0,g+1);case i:var v=this.$locale().weekStart||0,x=(m<v?m+7:m)-v;return p(d?y-x:y+(6-x),g);case o:case c:return h(b+"Hours",0);case r:return h(b+"Minutes",1);case n:return h(b+"Seconds",2);case t:return h(b+"Milliseconds",3);default:return this.clone()}},p.endOf=function(e){return this.startOf(e,!1)},p.$set=function(i,s){var u,d=w.p(i),f="set"+(this.$u?"UTC":""),p=(u={},u[o]=f+"Date",u[c]=f+"Date",u[a]=f+"Month",u[l]=f+"FullYear",u[r]=f+"Hours",u[n]=f+"Minutes",u[t]=f+"Seconds",u[e]=f+"Milliseconds",u)[d],h=d===o?this.$D+(s-this.$W):s;if(d===a||d===l){var m=this.clone().set(c,1);m.$d[p](h),m.init(),this.$d=m.set(c,Math.min(this.$D,m.daysInMonth())).$d}else p&&this.$d[p](h);return this.init(),this},p.set=function(e,t){return this.clone().$set(e,t)},p.get=function(e){return this[w.p(e)]()},p.add=function(e,s){var c,u=this;e=Number(e);var d=w.p(s),f=t=>{var n=v(u);return w.w(n.date(n.date()+Math.round(t*e)),u)};if(d===a)return this.set(a,this.$M+e);if(d===l)return this.set(l,this.$y+e);if(d===o)return f(1);if(d===i)return f(7);var p=(c={},c[n]=6e4,c[r]=36e5,c[t]=1e3,c)[d]||1,h=this.$d.getTime()+e*p;return w.w(h,this)},p.subtract=function(e,t){return this.add(-1*e,t)},p.format=function(e){var t=this;if(!this.isValid())return"Invalid Date";var n=e||"YYYY-MM-DDTHH:mm:ssZ",r=w.z(this),o=this.$locale(),i=this.$H,a=this.$m,s=this.$M,l=o.weekdays,c=o.months,u=(e,r,o,i)=>e&&(e[r]||e(t,n))||o[r].substr(0,i),f=e=>w.s(i%12||12,e,"0"),p=o.meridiem||((e,t,n)=>{var r=e<12?"AM":"PM";return n?r.toLowerCase():r}),h={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:w.s(s+1,2,"0"),MMM:u(o.monthsShort,s,c,3),MMMM:u(c,s),D:this.$D,DD:w.s(this.$D,2,"0"),d:String(this.$W),dd:u(o.weekdaysMin,this.$W,l,2),ddd:u(o.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(i),HH:w.s(i,2,"0"),h:f(1),hh:f(2),a:p(i,a,!0),A:p(i,a,!1),m:String(a),mm:w.s(a,2,"0"),s:String(this.$s),ss:w.s(this.$s,2,"0"),SSS:w.s(this.$ms,3,"0"),Z:r};return n.replace(d,((e,t)=>t||h[e]||r.replace(":","")))},p.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},p.diff=function(e,c,u){var d,f=w.p(c),p=v(e),h=6e4*(p.utcOffset()-this.utcOffset()),m=this-p,g=w.m(this,p);return g=(d={},d[l]=g/12,d[a]=g,d[s]=g/3,d[i]=(m-h)/6048e5,d[o]=(m-h)/864e5,d[r]=m/36e5,d[n]=m/6e4,d[t]=m/1e3,d)[f]||m,u?g:w.a(g)},p.daysInMonth=function(){return this.endOf(a).$D},p.$locale=function(){return g[this.$L]},p.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=b(e,t,!0);return r&&(n.$L=r),n},p.clone=function(){return w.w(this.$d,this)},p.toDate=function(){return new Date(this.valueOf())},p.toJSON=function(){return this.isValid()?this.toISOString():null},p.toISOString=function(){return this.$d.toISOString()},p.toString=function(){return this.$d.toUTCString()},f}(),$=x.prototype;return v.prototype=$,[["$ms",e],["$s",t],["$m",n],["$H",r],["$W",o],["$M",a],["$y",l],["$D",c]].forEach((function(e){$[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),v.extend=(e,t)=>(e.$i||(e(t,x,v),e.$i=!0),v),v.locale=b,v.isDayjs=y,v.unix=e=>v(1e3*e),v.en=g[m],v.Ls=g,v.p={},v}()}));const pe=(e,t,n)=>new Promise(((r,o)=>{if(n=Object.assign({concurrency:1/0},n),"function"!=typeof t)throw new TypeError("Mapper function is required");const{concurrency:i}=n;if(!("number"==typeof i&&i>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${i}\` (${typeof i})`);const a=[],s=e[Symbol.iterator]();let l=!1,c=!1,u=0,d=0;const f=()=>{if(l)return;const e=s.next(),n=d;if(d++,e.done)return c=!0,void(0===u&&r(a));u++,Promise.resolve(e.value).then((e=>t(e,n))).then((e=>{a[n]=e,u--,f()}),(e=>{l=!0,o(e)}))};for(let e=0;e<i&&(f(),!c);e++);}));var he=pe,me=pe;he.default=me;const ge=[],ye={"&amp;":"＆","&lt;":"＜","&gt;":"＞","&quot;":'"',"&apos;":"'","&nbsp;":" "};function be(e){if(!e||e===!!e||e===+e)return String(e);if(e.constructor===String)return e;if(e.hasOwnProperty("toString")||"symbol"==typeof e)return e.toString();if(e.hasOwnProperty("toJSON"))return JSON.stringify(e,null,"  ");const t=e.message?be(e.message):JSON.stringify(e,null,"  "),n=e.name||e.constructor.name;return n&&"Object"!=n&&"Error"!=n?n+": "+t:t}const ve=/[\/\?<>\\:\*\|"]/g,we=/[\x00-\x1f\x80-\x9f]/g,xe=/^\.+$/,$e=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,ke=/[\. ]+$/;function _e(e){return e.replace(ve,"-").replace(we,"-").replace(xe,"-").replace($e,"-").replace(ke,"-")}const Se=new TextEncoder;async function Ae(e){const t=new Uint8Array(await crypto.subtle.digest("SHA-256",e.constructor===String?Se.encode(e):e));return"_"+btoa(String.fromCharCode.apply(null,t)).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}function Ee(e,n){return n(((e,n=t)=>{let r;const o=[];function i(t){if(s(e,t)&&(e=t,r)){const t=!ge.length;for(let t=0;t<o.length;t+=1){const n=o[t];n[1](),ge.push(n,e)}if(t){for(let e=0;e<ge.length;e+=2)ge[e][0](ge[e+1]);ge.length=0}}}return{set:i,update:t=>{i(t(e))},subscribe:(a,s=t)=>{const l=[a,s];return o.push(l),1===o.length&&(r=n(i)||t),a(e),()=>{const e=o.indexOf(l);-1!==e&&o.splice(e,1),0===o.length&&(r(),r=null)}}}})(e))}const Me=Ee(new Set,(({subscribe:e,update:t})=>({subscribe:e,remove:e=>t((t=>(t.delete(e),t))),add:e=>t((t=>t.add(be(e)))),clear:()=>t((e=>(e.clear(),e)))}))),Oe=Ee(0,(({subscribe:e,set:t})=>{let n=0,r=0;return{subscribe:e,set total(e){n=e},inc:()=>t(100*++r/n|0),clear:()=>r&&t(n=r=0)}}));function Ce(e,t){const n=e.getElementsByTagName(t);return n[Symbol.iterator]?n:Array.from(n)}function Te(e){const t=history[e];return Object.assign((function(){try{return t.apply(this,arguments)}finally{window.dispatchEvent(new Event(e))}}),{destroy(){history[e]=t}})}async function De(e,t,n="GET",r){const o=await fetch(e,{method:n,credentials:"include",signal:t,headers:{"x-requested-with":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"},body:r});return 200===o.status?He(await o.text()):null}function je(e){return{name:e.statusText,message:e.status}}function Le(e){return async(t,n)=>{const r=await fetch(e+t,{credentials:"include",signal:n,headers:{"x-requested-with":"XMLHttpRequest"}});if(r.status>=400)throw je(r);return r.json()}}const Pe={"image/gif":".gif","image/jpeg":".jpg","image/png":".png","image/x-ms-bmp":".bmp","image/bmp":".bmp","image/svg+xml":".svg","image/svg":".svg","image/webp":".webp","image/x-xbitmap":".xbm","image/x-xbm":".xbm"};function qe(e){return Pe[e]?e:"image/jpeg"}const Be=/^\s*data:([image\/jpnfwbpsv]+);base64/;async function Ne(e,t){const n=qe(t.type),r=new Uint8Array(await t.arrayBuffer());let o;return{url:e,ext:Pe[n],id:await Ae(r),mime:n,get cachedB64(){return o},b64:()=>o||new Promise(((e,n)=>{const r=new FileReader;r.onloadend=async()=>{try{if(2==r.readyState){const t=r.result;e(o=t.slice(t.indexOf(",")+1))}else n(r.error)}catch(e){n(e)}},r.readAsDataURL(t)})),data:()=>r}}const Ue="undefined"!=typeof GM_xmlhttpRequest?GM_xmlhttpRequest:GM.xmlHttpRequest;async function Ie(e,t,n,r){try{if(n.has(t))return n.get(t);e=(e||"").trim();let o=await(Be.test(t)?(async e=>{const t=qe(((e,t)=>{const n=e&&e.match(t);return n&&n.length>0?n[n.length-1]:null})(e,Be)),n=await Ae(e),r=e.slice(e.indexOf(",")+1);return{ext:Pe[t],url:e,id:n,mime:t,get cachedB64(){return r},b64:()=>r,data(){const e=atob(r),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;++r)n[r]=e.charCodeAt(r);return n}}})(t):(async(e,t,n)=>{let r=new AbortController;const o=()=>{n.removeEventListener("abort",o),r.abort()};n.addEventListener("abort",o,{once:!0});try{if(location.host!==new URL(e).host&&Ue){const{finalUrl:n,response:o}=await new Promise(((n,o)=>{function i(e){o(e),r.signal.removeEventListener("abort",a),a()}const{abort:a}=Ue({url:e,method:"GET",responseType:"blob",headers:{Referer:location.href},onprogress:n=>t.has(e)?i({name:"Exist",url:e}):t.has(n.finalUrl)?i({name:"Exist",url:n.finalUrl}):void 0,onabort(){i({name:"AbortError"})},onerror(e){i(e.error)},onload(e){e.status>=400?i(je(e)):(r.signal.removeEventListener("abort",a),n(e))}});r.signal.addEventListener("abort",a,{once:!0})}));return await Ne(n,o)}{const n=await fetch(e,{credentials:"include",cache:"force-cache",referrer:location.href,signal:r.signal});if(t.has(e))return t.get(e);if(n.status>=400)throw je(n);return t.has(n.url)?t.get(n.url):await Ne(n.url,await n.blob())}}catch(e){if("Exist"===(null==e?void 0:e.name))return t.get(e.url);throw e}finally{o()}})(t,n,r.signal));if(o)return o=n.get(o.id)||o,n.set(t,o),n.set(o.id,o),n.set(o.url,o),o;if(n.has(t))return n.get(t)}catch(n){"AbortError"!=(null==n?void 0:n.name)&&(console.error(n),Me.add(`Ошибка загрузки изображения\n${t}\n${e?`в главе\n"${e}"\n`:""}${be(n)}`))}}function He(e,t){const n=(new DOMParser).parseFromString(e,t||"text/html"),r=n.querySelector("parsererror");if(r)throw r.textContent;return n}function Re(e,t,n){const r=e.createElementNS(t.namespaceURI,n);for(;t.firstChild;)r.appendChild(t.firstChild);return t.parentNode.replaceChild(r,t),r}function Fe(e,t,...n){const r=n.filter((e=>e!=t)).join(",");r&&e.querySelectorAll(r).forEach((n=>Re(e,n,t)))}const Ke={image:"image",emphasis:"emphasis",strong:"strong",strikethrough:"strikethrough",underline:"strong",blockquote:"cite"},ze={image:"img",emphasis:"i",strong:"b",strikethrough:"s",underline:"u",blockquote:"blockquote"};function Ye(e){return e?e.replace(/"/g,"'"):null}async function We(e,t,n,r,o){let i=He(e=e.replace(/(\s*<br(\s+[^\/<>]+)?\/?>\s*)+/g,"</p><p>"));try{const{blockquote:a}=ze;if(i.querySelectorAll(".message-delete,.splitnewsnavigation,script,.adblock-service"+(o?"":",img")).forEach((e=>e.remove())),Fe(i,n.emphasis,"i","em","dfn","var","q","dd","address"),Fe(i,n.strong,"b","strong","mark"),Fe(i,n.strikethrough,"s","strike","del"),Fe(i,n.underline,"u","ins","abbr","a"),i.querySelectorAll(".game-message,.quote").forEach((e=>Re(i,e,a))),i.querySelectorAll(`body :not(header):not(section):not(${n.emphasis}):not(${n.strong}):not(${n.strikethrough}):not(${n.underline}):not(${a}):not(sub):not(sup):not(img):not(h1)`).forEach((e=>{"SECTION"!==e.parentElement.tagName&&getComputedStyle(e).display.includes("inline")?(e=>{for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.remove()})(e):Re(i,e,"div")})),e=i.documentElement.outerHTML,i.open(),i=He(e.replace(/<\/?div>/g,"</p><p>").replace(/<(\/)?blockquote>/g,`</p><$1${a}><p>`)),o&&await he(Array.from(i.querySelectorAll("img")),(async e=>{let r=await Ie(e.closest("section").querySelector("header").textContent,e.src,o,t);if(r){const t=Ye(e.alt),o=Ye(e.title),a=i.createElement(n.image);t&&a.setAttribute("alt",t),n===Ke?(await r.b64(),a.setAttribute("l:href","#"+r.id),e.parentNode.replaceChild(a,e),"SECTION"===a.parentElement.tagName&&(o&&(a.title=o),a.id=r.id)):n===ze&&(a.src="images/"+r.id+r.ext,o&&(a.title=o),a.id=r.id,e.parentNode.replaceChild(a,e))}else e.remove()}),{concurrency:r}),i.querySelectorAll(`body :not(${n.image})`).forEach(Ge),Fe(i,n.blockquote,a),e=i.body.innerHTML,i.open(),e=(e=((e,t)=>{let n;return t.replace(/&#?[\w\d]+;/g,(t=>{if(t in ye)return ye[t];if("#"===t[1]){const e=parseInt(t.slice(2),"x"===t[2]?16:10);switch(e){case 38:return"＆";case 60:return"＜";case 62:return"＞";case 160:return" ";default:if(e<=1114111)return String.fromCodePoint(e)}}return n||(e.title="",n=e.head.querySelector("title")),n.innerHTML=t,n.innerText}))})(i,e)).replace(/(\s*<p>\s*<\/p>\s*)+/g," "),n===Ke)return e=e.replace(/<(\/)?header>/g,"<$1title>"),o?e.replace(/><\/image>/g,"/>"):e;if(n===ze)return o?e.replace(/(<img[^>]+)>/gi,"$1/>"):e}finally{i.open()}}function Ge(e){for(;e.attributes.length>0;)e.removeAttribute(e.attributes.item(0).name)}function Je(e,t){return t.appendChild(e),{update(n){n!=t&&(t=n).appendChild(e)},destroy(){e.remove()}}}function*Xe(e){for(const[t,n]of e)t===n.id&&(yield n)}const Ze={янв:"jan",фев:"feb",мар:"mar",апр:"apr",мая:"may",июн:"jun",июл:"jul",авг:"aug",сен:"sep",окт:"oct",ноя:"nov",дек:"dec"};function Ve(e){return fe(e.replace(/(янв|фев|мар|апр|мая|июн|июл|авг|сен|окт|ноя|дек)[а-я]*/i,((e,t)=>Ze[t])).replace(/[^\w:\+\s]+/g,"").replace(/\s+/g," "))}class Qe{constructor(){this.programName="ranobe-ebook-loader 0.2.5",this.homePage=location.href}date(e){return this.d.format(e)}get isoDate(){return this.d.toISOString().replace(".000","")}extractTitle(e){return e.querySelector("h1").firstChild.textContent}}const et=Le("https://xn--80ac9aeh6f.xn--p1ai/api/v2/books/");class tt extends Qe{constructor(){super(...arguments),this.bookAlias=location.pathname.split("/",2).find(Boolean),this.homePage=`https://xn--80ac9aeh6f.xn--p1ai/${this.bookAlias}/`}static get injectTarget(){return document.getElementsByClassName("BookPageActions__actions")[0]}async parts(e,t,n){const{fullTitle:r,titleEn:o,genres:i,author:a,description:s,createTime:l,title:c,images:u,country:d}=await et(this.bookAlias,e.signal);this.covers=[u.vertical.find((e=>"bookMain"===e.processor)).url],this.d=fe(l),this.genres=i.map((e=>e.title)),this.title=c,this.subtitle=[r,o].filter(Boolean).join(" • "),this.description=s||"",this.lang=null==d?void 0:d.code,this.authors=[a].filter(Boolean);const{bookAlias:f}=this,p=(await et(f+"/chapters",e.signal)).items.filter((e=>e.hasUserPaid||"free"===e.availabilityStatus)).reverse();return Oe.total=p.length,he(p,(async({slug:r})=>{try{const{title:o,text:{text:i}}=await et(f+"/chapters/"+r,e.signal);if(i.includes("<img ")){const n=He(i);for(const r of Ce(n,"img"))await Ie(o,r.src,t,e);n.open()}return Oe.inc(),n?await n({title:o,text:i}):{title:o,text:i}}catch(t){throw e.abort(),t}}),{concurrency:5})}}tt.spa=!0,tt.component="Link Link_size_md Link_bordered Link_hover_filled BookPageActions__action",tt.color=e=>`rgba(48,55,69,${e})`;class nt extends Qe{static get injectTarget(){return document.getElementById("mc-fs-rate")}async parts(e,t,n){const r=this.bookAlias=document.querySelector(".r-fullstory-chapters-foot > a:nth-child(3n)").href.split("/",5).slice(-1)[0];this.covers=[document.querySelector('[itemprop="image"]').href],this.d=fe(document.querySelector('[itemprop="datePublished"]').getAttribute("content")),this.genres=Array.from(document.querySelectorAll('[itemprop="genre"] a'),(e=>e.textContent)),this.keywords=Array.from(document.querySelectorAll('[itemprop="keywords"] a'),(e=>e.textContent)).join(", "),this.title=this.extractTitle(document),this.subtitle=document.querySelector('[itemprop="alternateName"]').textContent,this.description=document.querySelector('[itemprop="description"]').innerHTML,this.authors=Array.from(document.querySelectorAll('[itemprop="creator"] a'),(e=>({name:e.textContent,homePage:e.href})));const o=[];for(let t=1;;++t){const n=await De(`https://ranobes.com/chapters/${r}/page/${t}/`,e.signal);if(!n)break;n.querySelectorAll(`.cat_block a[href^="https://ranobes.com/chapters/${r}/"]`).forEach((e=>o.push(e.href)))}return Oe.total=o.length,he(o.reverse(),(async o=>{try{let i="",a="";const s=[o];for(const n of s){const o=await De(n,e.signal);if(!o)break;const l=o.getElementById("arrticle");if(i+=l.outerHTML,!a){a=this.extractTitle(o);const e=o.querySelector(".splitnewsnavigation");e&&e.querySelectorAll(`a[href^="https://ranobes.com/chapters/${r}/"]`).forEach((e=>s.push(e.href)))}for(const n of Ce(l,"img"))await Ie(a,n.src,t,e);o.open()}return Oe.inc(),n?await n({title:a,text:i}):{title:a,text:i}}catch(t){throw e.abort(),t}}),{concurrency:5})}}nt.component="btn btn-block",nt.color=e=>`rgba(149,172,124,${e})`;const rt=Le("");class ot extends Qe{constructor(){super(...arguments),this.chapterElements=Array.from(document.querySelectorAll("#Chapters .btn-info"))}static get injectTarget(){return document.querySelector("#Info > .btn-toolbar")}async parts(e,t,n){const r=document.getElementById("Info");this.covers=Array.from(r.querySelectorAll(".slick img"),(e=>e.src));const o=this.covers.find((e=>/\.jpe?g($|\?)/i.test(e)));return o&&this.covers.unshift(o),this.covers=Array.from(new Set(this.covers)),this.d=Ve(this.chapterElements[this.chapterElements.length-1].parentElement.previousElementSibling.previousElementSibling.firstElementChild.getAttribute("title")),this.genres=Array.from(document.querySelectorAll('.info a[href^="/search?genres"]'),(e=>e.textContent)),this.keywords=Array.from(document.querySelectorAll('.info a[href^="/search?tags"]'),(e=>e.textContent)).join(", "),this.subtitle=this.extractTitle(document),this.title=this.subtitle.substring(this.subtitle.lastIndexOf(" / ")+3),this.description=r.querySelector(".btn-toolbar + .clear + div").innerHTML,this.authors=Array.from(document.getElementById("Info").querySelectorAll('a[href^="/search?from=book&t="]')).filter((e=>"Автор:"===e.parentElement.previousElementSibling.textContent)).map((e=>({name:e.textContent,homePage:e.href}))),this.bookAlias=_e(this.title),Oe.total=this.chapterElements.length,he(this.chapterElements.map((e=>e.href)),(async r=>{try{let{title:o,content:i}=await rt(r.replace(/_new$/,"")+"ajax?is_new=true",e.signal);if(i=i.split(/<div class="content-text" style="word-wrap: break-word;">|<p>https?:\/\/tl\.rulate\.ru\/book\//,3)[1],i.includes("<img ")){const n=He(i);for(const r of Ce(n,"img"))await Ie(o,r.src,t,e);n.open()}return Oe.inc(),n?await n({title:o,text:i}):{title:o,text:i}}catch(t){throw e.abort(),t}}),{concurrency:5})}}ot.component="btn btn-info",ot.color=e=>`rgba(0,85,128,${e})`;class it extends Qe{static get injectTarget(){return document.getElementsByClassName("link-last-first-chapter")[0]}async parts(e,t,n){var r,o,i;const a=document.getElementsByClassName("box-book")[0];this.covers=Array.from(a.querySelectorAll(".img-book img"),(e=>e.src)),this.d=Ve(a.querySelector(".date-home").textContent);const s=Array.from(document.querySelectorAll("#info-book > p"),(e=>e.textContent));this.genres=(null===(o=null===(r=s.find((e=>e.startsWith("Жанры: "))))||void 0===r?void 0:r.substr(7))||void 0===o?void 0:o.split(", "))||[],this.keywords="",this.title=this.extractTitle(document),this.subtitle=[this.title,null===(i=s.find((e=>e.startsWith("Название: "))))||void 0===i?void 0:i.substr(10)].filter(Boolean).join(" • "),this.description=a.querySelector("#desc-tab").innerHTML,this.authors=s.filter((e=>e.startsWith("Автор: "))).map((e=>({name:e.substr(7)}))),this.bookAlias=_e(this.title);const l=a.querySelector(".like-but").id,c=await De("https://jaomix.ru/wp-admin/admin-ajax.php",e.signal,"POST",new URLSearchParams({action:"toc",selectall:l}).toString()),u=(await he(Ce(c,"option"),(async({value:t})=>{if("0"===t)return Array.from(document.getElementById("open-0").getElementsByTagName("a"),(e=>e.href));{const n=await De("https://jaomix.ru/wp-admin/admin-ajax.php",e.signal,"POST",new URLSearchParams({action:"toc",page:t,termid:l}).toString());try{return Array.from(n.getElementsByTagName("a"),(e=>e.href))}finally{n.open()}}}),{concurrency:5})).flat().reverse();return c.open(),Oe.total=u.length,he(u,(async r=>{try{const o=await De(r,e.signal),i=this.extractTitle(o),a=o.getElementsByClassName("entry")[0];for(const n of Ce(a,"img"))await Ie(i,n.src,t,e);const s=a.outerHTML;return o.open(),Oe.inc(),n?await n({title:i,text:s}):{title:i,text:s}}catch(t){throw e.abort(),t}}),{concurrency:5})}}it.component="lie-but",it.color=e=>`rgba(51,51,51,${e})`;const at=(e=>{var t=Object.prototype.hasOwnProperty;function n(e,r){return Array.isArray(e)?((e,t)=>{for(var r,o="",i="",s=Array.isArray(t),l=0;l<e.length;l++)(r=n(e[l]))&&(s&&t[l]&&(r=a(r)),o=o+i+r,i=" ");return o})(e,r):e&&"object"==typeof e?(e=>{var n="",r="";for(var o in e)o&&e[o]&&t.call(e,o)&&(n=n+r+o,r=" ");return n})(e):e||""}function r(e){if(!e)return"";if("object"==typeof e){var n="";for(var r in e)t.call(e,r)&&(n=n+r+":"+e[r]+";");return n}return e+""}function o(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var o=typeof t;return"object"!==o&&"function"!==o||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=a(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}e.merge=function e(t,n){if(1===arguments.length){for(var o=t[0],i=1;i<t.length;i++)o=e(o,t[i]);return o}for(var a in n)if("class"===a){var s=t[a]||[];t[a]=(Array.isArray(s)?s:[s]).concat(n[a]||[])}else if("style"===a){s=(s=r(t[a]))&&";"!==s[s.length-1]?s+";":s;var l=r(n[a]);l=l&&";"!==l[l.length-1]?l+";":l,t[a]=s+l}else t[a]=n[a];return t},e.classes=n,e.style=r,e.attr=o,e.attrs=(e,i)=>{var a="";for(var s in e)if(t.call(e,s)){var l=e[s];if("class"===s){a=o(s,l=n(l),!1,i)+a;continue}"style"===s&&(l=r(l)),a+=o(s,l,!1,i)}return a};var i=/["&<>]/;function a(e){var t=""+e,n=i.exec(t);if(!n)return e;var r,o,a,s="";for(r=n.index,o=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}o!==r&&(s+=t.substring(o,r)),o=r+1,s+=a}return o!==r?s+t.substring(o,r):s}return e.escape=a,e.rethrow=function e(t,n,r,o){if(!(t instanceof Error))throw t;if(!("undefined"==typeof window&&n||o))throw t.message+=" on line "+r,t;try{o=o||require("fs").readFileSync(n,"utf8")}catch(n){e(t,null,r)}var i=3,a=o.split("\n"),s=Math.max(r-i,0),l=Math.min(a.length,r+i);throw i=a.slice(s,l).map(((e,t)=>{var n=t+s+1;return(n==r?"  > ":"    ")+n+"| "+e})).join("\n"),t.path=n,t.message=(n||"Pug")+":"+r+"\n"+i+"\n\n"+t.message,t},e})({});function st(e){var t,n="",r=e||{};return function(e,r,o,i,a,s,l,c,u,d,f,p){n+="<description><title-info>",(()=>{var e=s;if("number"==typeof e.length)for(var r=0,o=e.length;r<o;r++){var i=e[r];n=n+"<genre>"+at.escape(null==(t=i)?"":t)+"</genre>"}else for(var r in o=0,e)o++,i=e[r],n=n+"<genre>"+at.escape(null==(t=i)?"":t)+"</genre>"}).call(this),(()=>{var e=r;if("number"==typeof e.length)for(var o=0,i=e.length;o<i;o++){var a=e[o];n=n+"<author><first-name>"+at.escape(null==(t=a.name)?"":t)+"</first-name><last-name/>",a.homePage&&(n=n+"<home-page>"+at.escape(null==(t=a.homePage)?"":t)+"</home-page>"),n+="</author>"}else for(var o in i=0,e)i++,a=e[o],n=n+"<author><first-name>"+at.escape(null==(t=a.name)?"":t)+"</first-name><last-name/>",a.homePage&&(n=n+"<home-page>"+at.escape(null==(t=a.homePage)?"":t)+"</home-page>"),n+="</author>"}).call(this),n=n+"<book-title>"+at.escape(null==(t=p)?"":t)+"</book-title>",e&&(n=n+"<annotation>"+(null==(t=e)?"":t)+"</annotation>"),c&&(n=n+"<keywords>"+at.escape(null==(t=c)?"":t)+"</keywords>"),i&&(n+='<coverpage><image l:href="#cover"/></coverpage>'),n+="<lang>ru</lang>",u&&(n=n+"<src-lang>"+at.escape(null==(t=u)?"":t)+"</src-lang>"),n+="</title-info><document-info>",(()=>{var e=r;if("number"==typeof e.length)for(var o=0,i=e.length;o<i;o++){var a=e[o];n=n+"<author><first-name>"+at.escape(null==(t=a.name)?"":t)+"</first-name><last-name/>",a.homePage&&(n=n+"<home-page>"+at.escape(null==(t=a.homePage)?"":t)+"</home-page>"),n+="</author>"}else for(var o in i=0,e)i++,a=e[o],n=n+"<author><first-name>"+at.escape(null==(t=a.name)?"":t)+"</first-name><last-name/>",a.homePage&&(n=n+"<home-page>"+at.escape(null==(t=a.homePage)?"":t)+"</home-page>"),n+="</author>"}).call(this),n=n+"<program-used>"+(null==(t=d)?"":t)+"</program-used><date"+at.attr("value",f,!1,!0)+">"+(null==(t=a)?"":t)+"</date><src-url>"+at.escape(null==(t=l)?"":t)+"</src-url><id>"+at.escape(null==(t=o)?"":t)+"</id><version>1</version></document-info></description>"}.call(this,"annotation"in r?r.annotation:"undefined"!=typeof annotation?annotation:void 0,"authors"in r?r.authors:"undefined"!=typeof authors?authors:void 0,"bookAlias"in r?r.bookAlias:"undefined"!=typeof bookAlias?bookAlias:void 0,"cover"in r?r.cover:"undefined"!=typeof cover?cover:void 0,"fullDate"in r?r.fullDate:"undefined"!=typeof fullDate?fullDate:void 0,"genres"in r?r.genres:"undefined"!=typeof genres?genres:void 0,"homePage"in r?r.homePage:"undefined"!=typeof homePage?homePage:void 0,"keywords"in r?r.keywords:"undefined"!=typeof keywords?keywords:void 0,"lang"in r?r.lang:"undefined"!=typeof lang?lang:void 0,"programName"in r?r.programName:"undefined"!=typeof programName?programName:void 0,"shortDate"in r?r.shortDate:"undefined"!=typeof shortDate?shortDate:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}function lt(e){var t,n="",r=e||{};return function(e,r){n=n+"<!DOCTYPE html><body><header><p>"+at.escape(null==(t=r)?"":t)+"</p></header>",(()=>{var r=e;if("number"==typeof r.length)for(var o=0,i=r.length;o<i;o++){var a=r[o];n=n+"<section><header><p>"+at.escape(null==(t=a.title)?"":t)+"</p></header>"+(null==(t=a.text)?"":t)+"</section>"}else for(var o in i=0,r)i++,a=r[o],n=n+"<section><header><p>"+at.escape(null==(t=a.title)?"":t)+"</p></header>"+(null==(t=a.text)?"":t)+"</section>"}).call(this),n+="</body>"}.call(this,"chapters"in r?r.chapters:"undefined"!=typeof chapters?chapters:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}function ct(e){var t,n="",r=e||{};return function(e,r,o,i,a){n=n+'<?xml version="1.0" encoding="utf-8" ?><ncx version="2005-1" xmlns="http://www.daisy.org/z3986/2005/ncx/"><head><meta name="dtb:uid"'+at.attr("content",a,!1,!1)+'></meta><meta name="dtb:generator"'+at.attr("content",o,!1,!1)+'></meta><meta name="dtb:depth" content="1"></meta><meta name="dtb:totalPageCount" content="0"></meta><meta name="dtb:maxPageNumber" content="0"></meta></head><docTitle><text>'+at.escape(null==(t=i)?"":t)+"</text></docTitle>",(()=>{var r=e;if("number"==typeof r.length)for(var o=0,i=r.length;o<i;o++){var a=r[o];n=n+"<docAuthor><text>"+at.escape(null==(t=a.name)?"":t)+"</text></docAuthor>"}else for(var o in i=0,r)i++,a=r[o],n=n+"<docAuthor><text>"+at.escape(null==(t=a.name)?"":t)+"</text></docAuthor>"}).call(this),n+="<navMap>",(()=>{var e=r;if("number"==typeof e.length)for(var o=0,i=e.length;o<i;o++){var a=e[o];n=n+'<navPoint class="chapter"'+at.attr("playOrder",o+1,!1,!1)+at.attr("id",a.id,!1,!1)+"><navLabel><text>"+at.escape(null==(t=a.title)?"":t)+"</text></navLabel><content"+at.attr("src",a.id+".xhtml",!1,!1)+"></content></navPoint>"}else for(var o in i=0,e)i++,a=e[o],n=n+'<navPoint class="chapter"'+at.attr("playOrder",o+1,!1,!1)+at.attr("id",a.id,!1,!1)+"><navLabel><text>"+at.escape(null==(t=a.title)?"":t)+"</text></navLabel><content"+at.attr("src",a.id+".xhtml",!1,!1)+"></content></navPoint>"}).call(this),n+="</navMap></ncx>"}.call(this,"authors"in r?r.authors:"undefined"!=typeof authors?authors:void 0,"chapters"in r?r.chapters:"undefined"!=typeof chapters?chapters:void 0,"programName"in r?r.programName:"undefined"!=typeof programName?programName:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0,"uuid"in r?r.uuid:"undefined"!=typeof uuid?uuid:void 0),n}function ut(e){var t,n="",r=e||{};return function(e,r){n=n+'<?xml version="1.0" encoding="utf-8" ?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"><head><title>'+at.escape(null==(t=r)?"":t)+'</title><meta charset="utf-8"></meta></head><body><section epub:type="frontmatter toc"><header><h1>Содержание</h1></header><nav id="toc" epub:type="toc">               <ol>',(()=>{var r=e;if("number"==typeof r.length)for(var o=0,i=r.length;o<i;o++){var a=r[o];n=n+"<li"+at.attr("id",a.id,!1,!1)+"><a"+at.attr("href",a.id+".xhtml",!1,!1)+">"+at.escape(null==(t=a.title)?"":t)+"</a></li>"}else for(var o in i=0,r)i++,a=r[o],n=n+"<li"+at.attr("id",a.id,!1,!1)+"><a"+at.attr("href",a.id+".xhtml",!1,!1)+">"+at.escape(null==(t=a.title)?"":t)+"</a></li>"}).call(this),n+="</ol></nav></section></body></html>"}.call(this,"chapters"in r?r.chapters:"undefined"!=typeof chapters?chapters:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}function dt(e){var t,n="",r=e||{};return function(e,r,o,i,a,s,l,c,u){n=n+'<?xml version="1.0" encoding="utf-8" ?><package version="3.0" unique-identifier="BookId" xmlns="http://www.idpf.org/2007/opf"><metadata xmlns:dc="http://purl.org/dc/elements/1.1/"><dc:identifier id="BookId">'+at.escape(null==(t=u)?"":t)+'</dc:identifier><dc:title id="main">'+at.escape(null==(t=c)?"":t)+'</dc:title><meta refines="#main" property="title-type">main</meta>',l&&(n=n+'<dc:title id="subtitle">'+at.escape(null==(t=l)?"":t)+'</dc:title><meta refines="#subtitle" property="title-type">subtitle</meta>'),n+="<dc:language>ru</dc:language>",e&&(n=n+"<dc:description>"+at.escape(null==(t=e)?"":t)+"</dc:description>"),(()=>{var e=r;if("number"==typeof e.length)for(var o=0,i=e.length;o<i;o++){var a=e[o];n=0===o?n+'<dc:creator id="author">'+at.escape(null==(t=a.name)?"":t)+'</dc:creator><meta refines="#author" property="role" scheme="marc:relators">aut</meta>':n+"<dc:creator>"+at.escape(null==(t=a.name)?"":t)+"</dc:creator>"}else for(var o in i=0,e)i++,a=e[o],n=0===o?n+'<dc:creator id="author">'+at.escape(null==(t=a.name)?"":t)+'</dc:creator><meta refines="#author" property="role" scheme="marc:relators">aut</meta>':n+"<dc:creator>"+at.escape(null==(t=a.name)?"":t)+"</dc:creator>"}).call(this),i&&(n+='<meta name="cover" content="CoverImage"></meta>'),n=n+"<dc:date>"+(null==(t=s)?"":t)+'</dc:date><meta property="dcterms:modified">'+(null==(t=s)?"":t)+"</meta></metadata><manifest>",i&&(n=n+'<item id="CoverImage"'+at.attr("href","images/"+i.id+i.ext,!1,!1)+at.attr("media-type",i.mime,!1,!1)+' properties="cover-image"></item>'),(()=>{var e=a;if("number"==typeof e.length)for(var t=0,r=e.length;t<r;t++){var o=e[t];i!=o&&(n=n+"<item"+(at.attr("id",o.id,!1,!1)+at.attr("media-type",o.mime,!1,!1)+at.attr("href","images/"+o.id+o.ext,!1,!1))+"></item>")}else for(var t in r=0,e)r++,o=e[t],i!=o&&(n=n+"<item"+(at.attr("id",o.id,!1,!1)+at.attr("media-type",o.mime,!1,!1)+at.attr("href","images/"+o.id+o.ext,!1,!1))+"></item>")}).call(this),n+='<item id="ncx" href="toc.ncx" media-type="application/x-dtbncx+xml"></item><item id="nav" href="nav.xhtml" media-type="application/xhtml+xml" properties="nav"></item>',(()=>{var e=o;if("number"==typeof e.length)for(var t=0,r=e.length;t<r;t++){var i=e[t];n=n+"<item"+(at.attr("id",i.id,!1,!1)+at.attr("href",i.id+".xhtml",!1,!1))+' media-type="application/xhtml+xml"></item>'}else for(var t in r=0,e)r++,i=e[t],n=n+"<item"+(at.attr("id",i.id,!1,!1)+at.attr("href",i.id+".xhtml",!1,!1))+' media-type="application/xhtml+xml"></item>'}).call(this),n+='</manifest><spine toc="ncx"><itemref idref="nav"></itemref>',(()=>{var e=o;if("number"==typeof e.length)for(var t=0,r=e.length;t<r;t++){var i=e[t];n=n+"<itemref"+at.attr("idref",i.id,!1,!1)+"></itemref>"}else for(var t in r=0,e)r++,i=e[t],n=n+"<itemref"+at.attr("idref",i.id,!1,!1)+"></itemref>"}).call(this),n+="</spine></package>"}.call(this,"annotation"in r?r.annotation:"undefined"!=typeof annotation?annotation:void 0,"authors"in r?r.authors:"undefined"!=typeof authors?authors:void 0,"chapters"in r?r.chapters:"undefined"!=typeof chapters?chapters:void 0,"cover"in r?r.cover:"undefined"!=typeof cover?cover:void 0,"images"in r?r.images:"undefined"!=typeof images?images:void 0,"isoDate"in r?r.isoDate:"undefined"!=typeof isoDate?isoDate:void 0,"subtitle"in r?r.subtitle:"undefined"!=typeof subtitle?subtitle:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0,"uuid"in r?r.uuid:"undefined"!=typeof uuid?uuid:void 0),n}var ft="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function pt(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on".concat(t),(()=>{n(window.event)}))}function ht(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function mt(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}for(var gt={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,"⇪":20,",":188,".":190,"/":191,"`":192,"-":ft?173:189,"=":ft?61:187,";":ft?59:186,"'":222,"[":219,"]":221,"\\":220},yt={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},bt={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},vt={16:!1,18:!1,17:!1,91:!1},wt={},xt=1;xt<20;xt++)gt["f".concat(xt)]=111+xt;var $t=[],kt="all",_t=[],St=e=>gt[e.toLowerCase()]||yt[e.toLowerCase()]||e.toUpperCase().charCodeAt(0);function At(e){kt=e||"all"}function Et(){return kt||"all"}var Mt=e=>{var t=e.key,n=e.scope,r=e.method,o=e.splitKey,i=void 0===o?"+":o;mt(t).forEach((e=>{var t=e.split(i),o=t.length,a=t[o-1],s="*"===a?"*":St(a);if(wt[s]){n||(n=Et());var l=o>1?ht(yt,t):[];wt[s]=wt[s].map((e=>r&&e.method!==r||e.scope!==n||!((e,t)=>{for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,o=!0,i=0;i<n.length;i++)-1===r.indexOf(n[i])&&(o=!1);return o})(e.mods,l)?e:{}))}}))};function Ot(e,t,n){var r;if(t.scope===n||"all"===t.scope){for(var o in r=t.mods.length>0,vt)Object.prototype.hasOwnProperty.call(vt,o)&&(!vt[o]&&t.mods.indexOf(+o)>-1||vt[o]&&-1===t.mods.indexOf(+o))&&(r=!1);(0!==t.mods.length||vt[16]||vt[18]||vt[17]||vt[91])&&!r&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function Ct(e){var t=wt["*"],n=e.keyCode||e.which||e.charCode;if(Tt.filter.call(this,e)){if(93!==n&&224!==n||(n=91),-1===$t.indexOf(n)&&229!==n&&$t.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach((t=>{var n=bt[t];e[t]&&-1===$t.indexOf(n)?$t.push(n):!e[t]&&$t.indexOf(n)>-1?$t.splice($t.indexOf(n),1):"metaKey"===t&&e[t]&&3===$t.length&&(e.ctrlKey||e.shiftKey||e.altKey||($t=$t.slice($t.indexOf(n))))})),n in vt){for(var r in vt[n]=!0,yt)yt[r]===n&&(Tt[r]=!0);if(!t)return}for(var o in vt)Object.prototype.hasOwnProperty.call(vt,o)&&(vt[o]=e[bt[o]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===$t.indexOf(17)&&$t.push(17),-1===$t.indexOf(18)&&$t.push(18),vt[17]=!0,vt[18]=!0);var i=Et();if(t)for(var a=0;a<t.length;a++)t[a].scope===i&&("keydown"===e.type&&t[a].keydown||"keyup"===e.type&&t[a].keyup)&&Ot(e,t[a],i);if(n in wt)for(var s=0;s<wt[n].length;s++)if(("keydown"===e.type&&wt[n][s].keydown||"keyup"===e.type&&wt[n][s].keyup)&&wt[n][s].key){for(var l=wt[n][s],c=l.splitKey,u=l.key.split(c),d=[],f=0;f<u.length;f++)d.push(St(u[f]));d.sort().join("")===$t.sort().join("")&&Ot(e,l,i)}}}function Tt(e,t,n){$t=[];var r=mt(e),o=[],i="all",a=document,s=0,l=!1,c=!0,u="+";for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(i=t.scope),t.element&&(a=t.element),t.keyup&&(l=t.keyup),void 0!==t.keydown&&(c=t.keydown),"string"==typeof t.splitKey&&(u=t.splitKey)),"string"==typeof t&&(i=t);s<r.length;s++)o=[],(e=r[s].split(u)).length>1&&(o=ht(yt,e)),(e="*"===(e=e[e.length-1])?"*":St(e))in wt||(wt[e]=[]),wt[e].push({keyup:l,keydown:c,scope:i,mods:o,shortcut:r[s],method:n,key:r[s],splitKey:u});void 0!==a&&!(e=>_t.indexOf(e)>-1)(a)&&window&&(_t.push(a),pt(a,"keydown",(e=>{Ct(e)})),pt(window,"focus",(()=>{$t=[]})),pt(a,"keyup",(e=>{Ct(e),(e=>{var t=e.keyCode||e.which||e.charCode,n=$t.indexOf(t);if(n>=0&&$t.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&$t.splice(0,$t.length),93!==t&&224!==t||(t=91),t in vt)for(var r in vt[t]=!1,yt)yt[r]===t&&(Tt[r]=!1)})(e)})))}var Dt={setScope:At,getScope:Et,deleteScope:(e,t)=>{var n,r;for(var o in e||(e=Et()),wt)if(Object.prototype.hasOwnProperty.call(wt,o))for(n=wt[o],r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++;Et()===e&&At(t||"all")},getPressedKeyCodes:()=>$t.slice(0),isPressed:e=>("string"==typeof e&&(e=St(e)),-1!==$t.indexOf(e)),filter:e=>{var t=e.target||e.srcElement,n=t.tagName,r=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(r=!1),r},unbind:function(e){if(e){if(Array.isArray(e))e.forEach((e=>{e.key&&Mt(e)}));else if("object"==typeof e)e.key&&Mt(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=n[0],i=n[1];"function"==typeof o&&(i=o,o=""),Mt({key:e,scope:o,method:i,splitKey:"+"})}}else Object.keys(wt).forEach((e=>delete wt[e]))}};for(var jt in Dt)Object.prototype.hasOwnProperty.call(Dt,jt)&&(Tt[jt]=Dt[jt]);if("undefined"!=typeof window){var Lt=window.hotkeys;Tt.noConflict=e=>(e&&window.hotkeys===Tt&&(window.hotkeys=Lt),Tt),window.hotkeys=Tt}function Pt(e){let n,r;return{c:t,m(t,o){n||(r=u(qt.call(null,window,e[0])),n=!0)},p:t,i:t,o:t,d(e){n=!1,r()}}}function qt(e,t){return Tt("ctrl+s",(e=>{e.stopImmediatePropagation(),e.preventDefault(),t()})),{destroy(){Tt.unbind("ctrl+s")}}}function Bt(e){const t=P();return[()=>{t("save")}]}class Nt extends ce{constructor(e){super(),le(this,e,Bt,Pt,s,{})}}function Ut(e){let n,r,o,i,a,s,l,c,u,d,f,p,h,m,w,S,E,M,O,C,T,D,j,L,P,q,B,N,U,I,H,R=e[1]+"%";return{c(){n=v("div"),r=v("div"),o=v("div"),i=x(),a=v("div"),s=x(),l=v("div"),c=x(),u=v("div"),d=x(),f=v("div"),p=x(),h=v("div"),m=x(),w=v("div"),S=x(),E=v("div"),M=x(),O=v("div"),C=x(),T=v("div"),D=x(),j=v("div"),L=x(),P=v("div"),q=x(),N=x(),U=v("button"),U.textContent="Cancel",k(o,"class","u_c1"),k(a,"class","u_c2"),k(l,"class","u_c3"),k(u,"class","u_c4"),k(f,"class","u_c5"),k(h,"class","u_c6"),k(w,"class","u_c7"),k(E,"class","u_c8"),k(O,"class","u_c9"),k(T,"class","u_c10"),k(j,"class","u_c11"),k(P,"class","u_c12"),B=new A(null),k(r,"class","u_c"),k(U,"class","u_cancel"),k(n,"class","u_b"),_(n,"--uc",e[0](1)),_(n,"--uch",e[0](.5)),_(n,"--uct",e[0](0))},m(t,b){y(t,n,b),g(n,r),g(r,o),g(r,i),g(r,a),g(r,s),g(r,l),g(r,c),g(r,u),g(r,d),g(r,f),g(r,p),g(r,h),g(r,m),g(r,w),g(r,S),g(r,E),g(r,M),g(r,O),g(r,C),g(r,T),g(r,D),g(r,j),g(r,L),g(r,P),g(r,q),B.m(R,r),g(n,N),g(n,U),I||(H=$(U,"click",e[2]),I=!0)},p(e,[t]){2&t&&R!==(R=e[1]+"%")&&B.p(R),1&t&&_(n,"--uc",e[0](1)),1&t&&_(n,"--uch",e[0](.5)),1&t&&_(n,"--uct",e[0](0))},i:t,o:t,d(e){e&&b(n),I=!1,H()}}}function It(e,t,n){let r;l(e,Oe,(e=>n(1,r=e)));let{color:o=(()=>"red")}=t;const i=P();return e.$$set=e=>{"color"in e&&n(0,o=e.color)},[o,r,()=>{i("cancel")}]}class Ht extends ce{constructor(e){var t;super(),document.getElementById("svelte-14hxf0y-style")||((t=v("style")).id="svelte-14hxf0y-style",t.textContent='.u_b{position:fixed;z-index:16777270;right:0;bottom:0;background:hsla(0,0%,100%,.8);width:100vw;height:100vh;-webkit-user-select:none;user-select:none;display:flex;flex-direction:column;align-items:center;justify-content:center}.u_cancel{margin-top:5%;border:0;background-color:var(--uc);color:#fff;padding:0 2em;line-height:2.7em;border-radius:3px;cursor:pointer;box-shadow:0 0 0 6px var(--uct);transition:box-shadow .1s;font-family:Ubuntu,Segoe UI,Optima,Trebuchet MS,-apple-system,BlinkMacSystemFont,sans-serif!important;font-size:16px}@media screen and (min-width:240px){.u_cancel{font-size:calc(16px + 8*(100vw - 240px)/720)}}@media screen and (min-width:960px){.u_cancel{font-size:24px}}.u_cancel:active,.u_cancel:focus,.u_cancel:hover{outline:0;box-shadow:0 0 0 6px var(--uch)}.u_c{position:relative;pointer-events:none;width:100px;height:100px;line-height:100px;text-align:center;color:var(--uc);font-family:Ubuntu,Segoe UI,Optima,Trebuchet MS,-apple-system,BlinkMacSystemFont,sans-serif!important;font-size:14px}@media screen and (min-width:240px){.u_c{font-size:calc(14px + 7*(100vw - 240px)/720)}}@media screen and (min-width:960px){.u_c{font-size:21px}}.u_c>*{width:100%;height:100%;position:absolute}.u_c>:before{content:"";display:block;margin:0 auto;width:15%;height:15%;background-color:var(--uc);border-radius:100%;animation:u_a 1.2s ease-in-out infinite both}.u_c2{transform:rotate(30deg)}.u_c2:before{animation-delay:-1.1s}.u_c3{transform:rotate(60deg)}.u_c3:before{animation-delay:-1s}.u_c4{transform:rotate(90deg)}.u_c4:before{animation-delay:-.9s}.u_c5{transform:rotate(120deg)}.u_c5:before{animation-delay:-.8s}.u_c6{transform:rotate(150deg)}.u_c6:before{animation-delay:-.7s}.u_c7{transform:rotate(180deg)}.u_c7:before{animation-delay:-.6s}.u_c8{transform:rotate(210deg)}.u_c8:before{animation-delay:-.5s}.u_c9{transform:rotate(240deg)}.u_c9:before{animation-delay:-.4s}.u_c10{transform:rotate(270deg)}.u_c10:before{animation-delay:-.3s}.u_c11{transform:rotate(300deg)}.u_c11:before{animation-delay:-.2s}.u_c12{transform:rotate(330deg)}.u_c12:before{animation-delay:-.1s}@keyframes u_a{0%,80%,to{transform:scale(0)}40%{transform:scale(1)}}',g(document.head,t)),le(this,e,It,Ut,s,{color:0})}}function Rt(e){let t,n;const r=e[2].default,o=((e,t,n,r)=>{if(e){const r=c(e,t,n,null);return e[0](r)}})(r,e,e[1]);return{c(){t=v("menu"),o&&o.c(),k(t,"type","context"),k(t,"id",e[0])},m(e,r){y(e,t,r),o&&o.m(t,null),n=!0},p(e,[t]){o&&o.p&&2&t&&function(e,t,n,r,o,i,a){const s=((e,t,n,r)=>{if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty})(t,r,o,i);if(s){const o=c(t,n,r,a);e.p(o,s)}}(o,r,e,e[1],t,null,null)},i(e){n||(ee(o,e),n=!0)},o(e){te(o,e),n=!1},d(e){e&&b(t),o&&o.d(e)}}}function Ft(e,t,n){let{$$slots:r={},$$scope:o}=t;const i="_menu_ranobe-ebook-loader_"+Math.random().toString(16).replace(".","");return j((()=>document.body.setAttribute("contextmenu",i))),L((()=>document.body.removeAttribute("contextmenu"))),e.$$set=e=>{"$$scope"in e&&n(1,o=e.$$scope)},[i,o,r]}class Kt extends ce{constructor(e){super(),le(this,e,Ft,Rt,s,{})}}function zt(e){let n,r,o,s;return{c(){n=v("menuitem"),k(n,"label",e[0]),k(n,"icon",e[1])},m(t,i){y(t,n,i),o||(s=[$(n,"click",e[2]),u(r=e[3].call(null,n,e[0]))],o=!0)},p(e,[t]){1&t&&k(n,"label",e[0]),2&t&&k(n,"icon",e[1]),r&&a(r.update)&&1&t&&r.update.call(null,e[0])},i:t,o:t,d(e){e&&b(n),o=!1,i(s)}}}function Yt(e,t,n){let{label:r="ranobe-ebook-loader"}=t,{icon:o="https://raw.githubusercontent.com/Taraflex/ranobe-ebook-loader/master/icons/32.png"}=t;const i=P();function a(){i("trigger")}return e.$$set=e=>{"label"in e&&n(0,r=e.label),"icon"in e&&n(1,o=e.icon)},[r,o,a,(e,t)=>{let n="undefined"!=typeof GM_registerMenuCommand&&GM_registerMenuCommand(t,a);function r(){n&&GM_unregisterMenuCommand(n)}return{destroy:r,update(e){r(),n="undefined"!=typeof GM_registerMenuCommand&&GM_registerMenuCommand(e,a)}}}]}class Wt extends ce{constructor(e){super(),le(this,e,Yt,zt,s,{label:0,icon:1})}}function Gt(e){const t=e-1;return t*t*t+1}function Jt(e,{delay:t=0,duration:n=400,easing:r=Gt}){const o=getComputedStyle(e),i=+o.opacity,a=parseFloat(o.height),s=parseFloat(o.paddingTop),l=parseFloat(o.paddingBottom),c=parseFloat(o.marginTop),u=parseFloat(o.marginBottom),d=parseFloat(o.borderTopWidth),f=parseFloat(o.borderBottomWidth);return{delay:t,duration:n,easing:r,css:e=>`overflow: hidden;opacity: ${Math.min(20*e,1)*i};height: ${e*a}px;padding-top: ${e*s}px;padding-bottom: ${e*l}px;margin-top: ${e*c}px;margin-bottom: ${e*u}px;border-top-width: ${e*d}px;border-bottom-width: ${e*f}px;`}}function Xt(e,t,n){const r=e.slice();return r[3]=t[n],r}function Zt(e,t){let n,r,o,a,s,l,c,u,d,f,p,h,m=t[3]+"";function _(){return t[1](t[3])}function S(...e){return t[2](t[3],...e)}return{key:e,first:null,c(){n=v("div"),r=v("div"),o=w(m),a=x(),s=v("div"),l=v("button"),l.textContent="🞩",c=x(),u=v("button"),u.textContent="⎀",k(r,"class","u_m"),k(l,"class","u_bf"),k(u,"class","u_bl"),k(u,"title","Click to copy"),k(s,"class","u_r"),k(n,"class","u_n"),this.first=n},m(e,t){y(e,n,t),g(n,r),g(r,o),g(n,a),g(n,s),g(s,l),g(s,c),g(s,u),f=!0,p||(h=[$(l,"click",_),$(u,"click",S)],p=!0)},p(e,n){t=e,(!f||1&n)&&m!==(m=t[3]+"")&&((e,t)=>{t=""+t,e.wholeText!==t&&(e.data=t)})(o,m)},i(e){f||(e&&F((()=>{d||(d=re(n,Jt,{},!0)),d.run(1)})),f=!0)},o(e){e&&(d||(d=re(n,Jt,{},!1)),d.run(0)),f=!1},d(e){e&&b(n),e&&d&&d.end(),p=!1,i(h)}}}function Vt(e){let n,r,o,i,a;return{c(){n=v("button"),n.textContent="Close all",k(n,"class","u_bb")},m(e,t){y(e,n,t),o=!0,i||(a=$(n,"click",Me.clear),i=!0)},p:t,i(e){o||(e&&F((()=>{r||(r=re(n,Jt,{},!0)),r.run(1)})),o=!0)},o(e){e&&(r||(r=re(n,Jt,{},!1)),r.run(0)),o=!1},d(e){e&&b(n),e&&r&&r.end(),i=!1,a()}}}function Qt(e){let t,n,r,o=[],i=new Map,a=Array.from(e[0]);const s=e=>e[3];for(let t=0;t<a.length;t+=1){let n=Xt(e,a,t),r=s(n);i.set(r,o[t]=Zt(r,n))}let l=e[0].size>2&&Vt();return{c(){t=v("div");for(let e=0;e<o.length;e+=1)o[e].c();n=x(),l&&l.c(),k(t,"class","u_d")},m(e,i){y(e,t,i);for(let e=0;e<o.length;e+=1)o[e].m(t,null);g(t,n),l&&l.m(t,null),r=!0},p(e,[r]){1&r&&(a=Array.from(e[0]),V(),o=((e,t,n,r,o,i,a,s,l,c,u,d)=>{let f=e.length,p=i.length,h=f;const m={};for(;h--;)m[e[h].key]=h;const g=[],y=new Map,b=new Map;for(h=p;h--;){const e=d(o,i,h),r=n(e);let s=a.get(r);s?s.p(e,t):(s=c(r,e),s.c()),y.set(r,g[h]=s),r in m&&b.set(r,Math.abs(h-m[r]))}const v=new Set,w=new Set;function x(e){ee(e,1),e.m(s,u),a.set(e.key,e),u=e.first,p--}for(;f&&p;){const t=g[p-1],n=e[f-1],r=t.key,o=n.key;t===n?(u=t.first,f--,p--):y.has(o)?!a.has(r)||v.has(r)?x(t):w.has(o)?f--:b.get(r)>b.get(o)?(w.add(r),x(t)):(v.add(o),f--):(l(n,a),f--)}for(;f--;){const t=e[f];y.has(t.key)||l(t,a)}for(;p;)x(g[p-1]);return g})(o,r,s,0,e,a,i,t,oe,Zt,n,Xt),Q()),e[0].size>2?l?(l.p(e,r),1&r&&ee(l,1)):(l=Vt(),l.c(),ee(l,1),l.m(t,null)):l&&(V(),te(l,1,1,(()=>{l=null})),Q())},i(e){if(!r){for(let e=0;e<a.length;e+=1)ee(o[e]);ee(l),r=!0}},o(e){for(let e=0;e<o.length;e+=1)te(o[e]);te(l),r=!1},d(e){e&&b(t);for(let e=0;e<o.length;e+=1)o[e].d();l&&l.d()}}}function en(e,t,n){let r;return l(e,Me,(e=>n(0,r=e))),[r,e=>Me.remove(e),(e,t)=>((e,t)=>{navigator.clipboard.writeText(e).then((()=>{const e=t.target.closest(".u_n");e.style.animation=null,e.getBoundingClientRect(),e.style.animation="u_shake 0.6s cubic-bezier(0.36, 0.07, 0.19, 0.97)"})).catch(Me.add)})(e,t)]}class tn extends ce{constructor(e){var t;super(),document.getElementById("svelte-v02y3s-style")||((t=v("style")).id="svelte-v02y3s-style",t.textContent=".u_d{position:fixed;z-index:16777270;right:0;bottom:0;bottom:3px;right:3px;display:flex;flex-direction:column;align-items:flex-end;color:#fff;pointer-events:none}.u_bb,.u_n{margin:3px;display:flex;pointer-events:auto;transform:translateZ(0);-webkit-backface-visibility:hidden;backface-visibility:hidden}.u_m{flex-grow:1;padding:6px 9px;border-top-left-radius:3px;border-bottom-left-radius:3px;white-space:pre-wrap;word-wrap:break-word;max-width:calc(100vw - 70px);font-family:Ubuntu,Segoe UI,Optima,Trebuchet MS,-apple-system,BlinkMacSystemFont,sans-serif!important;font-size:14px}.u_m,.u_r{background-color:rgba(213,0,0,.85)}.u_r{display:flex;flex-direction:column;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:1px}.u_b,.u_bb,.u_bf,.u_bl{background-color:transparent;padding:6px;border:0;-webkit-user-select:none;user-select:none;color:#fff;text-align:center;cursor:pointer;font-family:Ubuntu,Segoe UI,Optima,Trebuchet MS,-apple-system,BlinkMacSystemFont,sans-serif!important;font-size:14px}.u_bf{padding-bottom:0}.u_bl{padding-top:0}.u_bb{background-color:rgba(213,0,0,.85);border-radius:3px}@keyframes u_shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}",g(document.head,t)),le(this,e,en,Qt,s,{})}}var nn=de(((e,t)=>{(()=>{function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=()=>{a(r.response,t,n)},r.onerror=()=>{console.error("could not download file")},r.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof ue&&ue.global===ue?ue:void 0,i=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=o.saveAs||("object"!=typeof window||window!==o?()=>{}:"download"in HTMLAnchorElement.prototype&&!i?(e,i,a)=>{var s=o.URL||o.webkitURL,l=document.createElement("a");i=i||e.name||"download",l.download=i,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):n(l.href)?t(e,i,a):r(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((()=>{s.revokeObjectURL(l.href)}),4e4),setTimeout((()=>{r(l)}),0))}:"msSaveOrOpenBlob"in navigator?(e,o,i)=>{if(o=o||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,i),o);else if(n(e))t(e,o,i);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout((()=>{r(a)}))}}:(e,n,r,a)=>{if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var s="application/octet-stream"===e.type,l=/constructor/i.test(o.HTMLElement)||o.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||i)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=()=>{var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},u.readAsDataURL(e)}else{var d=o.URL||o.webkitURL,f=d.createObjectURL(e);a?a.location=f:location.href=f,a=null,setTimeout((()=>{d.revokeObjectURL(f)}),4e4)}});o.saveAs=a.saveAs=a,e.exports=a})()}));const rn={once:!0};function on(...e){const t=(()=>{let e,t;return{promise:new Promise(((n,r)=>{t=n,e=r})),resolve:t,reject:e}})();function n(){for(const[t,...r]of e)for(const e of r)t.removeEventListener(e,n);t.resolve(void 0)}for(const[t,...r]of e)for(const e of r)t.addEventListener(e,n,rn);return t}const an=new Uint8Array(16);async function sn(e,t){const n=new Uint8Array(t.byteLength+e.length);n.set(t,0),n.set(e,t.byteLength);const r=new Uint8Array(await crypto.subtle.digest("SHA-1",n)),o=new Uint8Array(16);return o.set(r.subarray(0,4),0),o.set(r.subarray(4,10),4),o.set(r.subarray(6,14),6),o[6]=15&o[6]|80,o[8]=63&r[8]|128,o[9]=r[9],o.set(r.subarray(10,16),10),o}let ln=null;async function cn(e){return ln||(ln=await sn(Se.encode("ranobe-ebook-loader"),an)),(e=>{let t="";for(let n=0;n<16;++n)t+=e[n].toString(16).padStart(2,"0");return[(n=t).slice(0,8),n.slice(8,12),n.slice(12,16),n.slice(16,20),n.slice(20)].join("-");var n})(await sn(Se.encode(e),ln))}const un=[];for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;un[e]=t}function dn(e){let t=-1;for(const n of e)t=t>>>8^un[255&(t^n)];return-1^t}function fn(e,t){const n=[];for(;t--;)n.push(255&e),e>>>=8;return n}function pn(e){let t,n,r,o,s,l,c,d,f,p,h,m,_,S;return t=new Nt({}),t.$on("save",e[5]),r=new Kt({props:{$$slots:{default:[mn]},$$scope:{ctx:e}}}),{c(){ie(t.$$.fragment),n=x(),ie(r.$$.fragment),o=x(),s=v("button"),l=w(yn),d=x(),f=v("button"),p=w(bn),k(s,"class",e[2].component),k(f,"class",e[2].component)},m(i,a){ae(t,i,a),y(i,n,a),ae(r,i,a),y(i,o,a),y(i,s,a),g(s,l),y(i,d,a),y(i,f,a),g(f,p),m=!0,_||(S=[$(s,"click",e[4]),u(c=Je.call(null,s,e[1])),$(f,"click",e[5]),u(h=Je.call(null,f,e[1]))],_=!0)},p(e,t){const n={};512&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n),c&&a(c.update)&&2&t&&c.update.call(null,e[1]),h&&a(h.update)&&2&t&&h.update.call(null,e[1])},i(e){m||(ee(t.$$.fragment,e),ee(r.$$.fragment,e),m=!0)},o(e){te(t.$$.fragment,e),te(r.$$.fragment,e),m=!1},d(e){se(t,e),e&&b(n),se(r,e),e&&b(o),e&&b(s),e&&b(d),e&&b(f),_=!1,i(S)}}}function hn(e){let n,r;return n=new Ht({props:{color:e[2].color}}),n.$on("cancel",e[3]),{c(){ie(n.$$.fragment)},m(e,t){ae(n,e,t),r=!0},p:t,i(e){r||(ee(n.$$.fragment,e),r=!0)},o(e){te(n.$$.fragment,e),r=!1},d(e){se(n,e)}}}function mn(e){let n,r,o,i;return n=new Wt({props:{label:yn}}),n.$on("trigger",e[4]),o=new Wt({props:{label:bn}}),o.$on("trigger",e[5]),{c(){ie(n.$$.fragment),r=x(),ie(o.$$.fragment)},m(e,t){ae(n,e,t),y(e,r,t),ae(o,e,t),i=!0},p:t,i(e){i||(ee(n.$$.fragment,e),ee(o.$$.fragment,e),i=!0)},o(e){te(n.$$.fragment,e),te(o.$$.fragment,e),i=!1},d(e){se(n,e),e&&b(r),se(o,e)}}}function gn(e){let t,n,r,o,i;const a=[hn,pn],s=[];function l(e,t){return e[0]?0:e[1]?1:-1}return~(t=l(e))&&(n=s[t]=a[t](e)),o=new tn({}),{c(){n&&n.c(),r=x(),ie(o.$$.fragment)},m(e,n){~t&&s[t].m(e,n),y(e,r,n),ae(o,e,n),i=!0},p(e,[o]){let i=t;t=l(e),t===i?~t&&s[t].p(e,o):(n&&(V(),te(s[i],1,1,(()=>{s[i]=null})),Q()),~t?(n=s[t],n?n.p(e,o):(n=s[t]=a[t](e),n.c()),ee(n,1),n.m(r.parentNode,r)):n=null)},i(e){i||(ee(n),ee(o.$$.fragment,e),i=!0)},o(e){te(n),te(o.$$.fragment,e),i=!1},d(e){~t&&s[t].d(e),e&&b(r),se(o,e)}}}const yn="Скачать *.fb2",bn="Скачать *.epub";function vn(e,t,n){const r={"ранобэ.рф":tt,"xn--80ac9aeh6f.xn--p1ai":tt,"ranobes.com":nt,"tl.rulate.ru":ot,"jaomix.ru":it}[location.hostname];let o,i=!1,a=null;function s(){o&&(o.abort(),o=null),i&&n(0,i=!1),Oe.clear()}const l=new AbortController;j((async()=>{if(r.spa){history.pushState=Te("pushState"),history.replaceState=Te("replaceState");const e=e=>setTimeout(e,2e3);for(;!l.signal.aborted;){for(;!n(1,a=r.injectTarget);)if(await new Promise(e),l.signal.aborted)return;await on([l.signal,"abort"],[window,"pushState","replaceState","popstate"]).promise,s(),await new Promise(e)}}else n(1,a=await r.injectTarget)})),L((()=>{var e,t,n,o;l.abort(),s(),r.spa&&(null===(t=(e=history.pushState).destroy)||void 0===t||t.call(e),null===(o=(n=history.replaceState).destroy)||void 0===o||o.call(n))}));const c=d.bind(null,Ke),u=d.bind(null,ze);async function d(e){if(!i&&a)try{s(),n(0,i=!0),o=new AbortController,Me.clear(),await(R(),I);const t=new Map,a=async e=>(e.id=await Ae(e.title),e.text=await We(function(e){var t,n="",r=e||{};return((e,r)=>{n=n+"<!DOCTYPE html><body><section><header><h1>"+at.escape(null==(t=r)?"":t)+"</h1></header>"+(null==(t=e)?"":t)+"</section></body>"}).call(this,"text"in r?r.text:"undefined"!=typeof text?text:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}(e),o,ze,1,t),e.text=function(e){var t,n="",r=e||{};return((e,r)=>{n=n+'<?xml version="1.0" encoding="utf-8" ?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"><head><title>'+at.escape(null==(t=r)?"":t)+'</title><style type="text/css">img{display:inline-block;width:auto;height:auto;max-width:100%;max-height:100%;page-break-before:avoid;page-break-after:auto;page-break-inside:avoid;}</style></head><body>'+(null==(t=e)?"":t)+"</body></html>"}).call(this,"text"in r?r.text:"undefined"!=typeof text?text:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}(e),e),l=new r,c=await l.parts(o,t,e===ze?a:null);switch(e){case ze:c.unshift(await a({title:"Аннотация",text:"<div>"+l.description+l.covers.map((e=>`<p><img src="${e}"/></p>`)).join("")+"</div>"}));const n=Array.from(Xe(t)),r=He(c[0].text).querySelector("section");r.firstElementChild.remove();const i={...l,cover:t.get(l.covers[0]),isoDate:l.isoDate,uuid:"urn:uuid:"+await cn(l.title+l.subtitle+c.map((e=>e.title)).join("")),annotation:r.innerText.trim(),chapters:c,images:n};r.ownerDocument.open(),t.clear();const s="application/epub+zip";return nn.saveAs(new Blob(Array.from(function*(e){let t=0;const n=[];let r=0;for(const{path:o,data:i}of e){const e=i instanceof Uint8Array?i:Se.encode(i),a=Se.encode(o),s=[10,0,0,0,0,0,0,0,0,0,...fn(dn(e),4),...fn(e.length,4),...fn(e.length,4),...fn(a.length,2),0,0];n.push(80,75,1,2,20,0,...s,0,0,0,0,0,0,0,0,0,0,...fn(t,4),...a);const l=new Uint8Array([80,75,3,4,...s]);t+=l.byteLength+e.byteLength+a.byteLength,++r,yield l,yield a,yield e}n.push(80,75,5,6,0,0,0,0,...fn(r,2),...fn(r,2),...fn(n.length,4),...fn(t,4),0,0),yield new Uint8Array(n)}([{path:"mimetype",data:s},{path:"META-INF/container.xml",data:'<?xml version="1.0" encoding="utf-8" ?><container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container"><rootfiles><rootfile full-path="OEBPS/content.opf" media-type="application/oebps-package+xml"></rootfile></rootfiles></container>'},{path:"META-INF/com.apple.ibooks.display-options.xml",data:'<?xml version="1.0" encoding="utf-8" ?><display_options><platform name="*"><option name="specified-fonts">true</option><option name="interactive">false</option></platform></display_options>'},{path:"OEBPS/toc.ncx",data:ct(i)},{path:"OEBPS/nav.xhtml",data:ut(i)},{path:"OEBPS/content.opf",data:dt(i)},...n.map((e=>({path:"OEBPS/images/"+e.id+e.ext,data:e.data()}))),...c.map((e=>({path:`OEBPS/${e.id}.xhtml`,data:e.text})))])),{type:s}),l.bookAlias+".epub");case Ke:l.genres.length<1&&l.genres.push("unrecognised");const u=await(l.covers[0]&&Ie("Обложка",l.covers[0],t,o));await(null==u?void 0:u.b64());const d=['<?xml version="1.0" encoding="utf-8"?><FictionBook xmlns="http://www.gribuser.ru/xml/fictionbook/2.0" xmlns:l="http://www.w3.org/1999/xlink">',st({...l,cover:u,annotation:await We("<div>"+l.description+"</div>",o,e,5),shortDate:l.date("YYYY-MM-DD"),fullDate:l.date("DD.MM.YYYY")}),"<body>",await We(lt({title:l.title,chapters:c}),o,e,5,t),"</body>"];for(const e of Xe(t))e.cachedB64&&d.push(`<binary id="${u&&u.id==e.id?"cover":e.id}" content-type="${e.mime}">`,e.cachedB64,"</binary>");return t.clear(),d.push("</FictionBook>"),nn.saveAs(new Blob(d,{type:"application/x-fictionbook+xml;charset=utf-8"}),l.bookAlias+".fb2")}}catch(e){"AbortError"!=(null==e?void 0:e.name)&&(console.error(e),Me.add(e))}finally{s()}}return console.log("ranobe-ebook-loader 0.2.5"),[i,a,r,s,c,u]}const wn={__proto__:null,default:class extends ce{constructor(e){var t;super(),document.getElementById("svelte-jnedj2-style")||((t=v("style")).id="svelte-jnedj2-style",t.textContent="#ranobe-ebook-loader{position:fixed;z-index:16777270;right:0;bottom:0}",g(document.head,t)),le(this,e,vn,gn,s,{})}}};
